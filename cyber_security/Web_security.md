# 核心防御机制
- Web应用程序采用的防御机制由以下几个核心因素构成
  - 处理用户访问应用程序的数据与功能，防止用户获得<font color=tomato>未授权访问</font>
  - 处理用户对应用程序功能的输入，防止<font color=tomato>错误输入</font>造成不良行为
  - 防范攻击者，确保应用程序在成为直接攻击目标时，能够正常运转，并采取适当的防御与攻击措施挫败攻击者
  - 管理应用程序本身，<font color=tomato>帮助管理员监控其行为</font>，配置其功能

## 处理用户访问
- 一般情况下，用户分为三类
  - 匿名用户
  - 正常通过验证的用户
  - 管理用户

- 大多数Web应用程序使用三层相互关联的安全机制处理用户访问
  - 身份验证
  - 会话管理
  - 访问控制
  
### 身份验证
- 定义：身份验证机制是应用程序处理用户访问的最基本机制

- 攻击Web应用程序时，渗透测试员应当投入大量精力，攻击应用程序采用的各种与身份验证有关的功能。
  - 出人意料的是，这种功能中存在的缺陷往往允许<font color=tomato>攻击者非法访问敏感数据与功能</font>

### 会话管理
- 就受攻击面而言，会话管理机制的有效性基本取决于其令牌的安全性

- 令牌生成过程中存在的缺陷是主要的漏洞来源，使攻击者能够推测出发布给其他用户的令牌。

### 访问控制
- 定义：
  - 做出并实施正确的决策，决定允许或拒绝每一个请求
  - 如果前面的机制运行正常，应用程序即可<font color=tomato>从收到的每一个请求确认用户的身份</font>。在此基础上，应用程序需要<font color=tomato>决定是否授权用户执行所请求的操做或访问相关数据</font>

- 由于典型访问控制的要求相当复杂，因此这种机制中一般存在<font color=tomato>大量的安全漏洞</font>，使得攻击者能够获得对应用程序的数据与功能的未授权访问


## 处理用户输入
### 输入处理方法
- 拒绝已知的不良输入-黑名单
  - 这种方法是确认用户输入效率最低的方法

- 接收已知的正常输入-白名单
  - <font color=tomato>在切实可行的情况下</font>，这种方式是处理潜在恶意输入的最有效方法

- 净化
  - 基于数据净化的方法一般非常有效。在许多情况下，可将其作为处理恶意输入问题的通用解决方法。
  - 然而，如果需要在一个输入项中容纳几种可能的恶意数据，可能就很难对其进行有效净化，这时，最好采用边界确认方法处理用户输入

- 安全数据处理
  - 以不安全的方式处理用户提交的数据，是许多Web应用程序漏洞形成的根本原因
  - <font color=tomato>通常不需要确认输入本身，只需要确保处理过程绝对安全，即可避免这些漏洞</font>
  - 这种方法并不适用于Web应用程序需要执行的每项任务，但如果适用，它是一种处理潜在恶意输入的通用方法

- 语法检查
  - 在一些漏洞中，攻击者提交的输入与普通的非恶意用户提交的输入完全相同。之所以称为恶意输入，是因为攻击者提交的动机不同。
  - 例如：攻击者可能会修改通过隐藏表单字段提交的账号，企图访问其他用户的银行账户。这时，再多的语法确认也无法区别用户与攻击者的数据。为防止未授权访问，应用程序必须确认所提交的账号属于之前提交该账号的用户（例如：攻击者适用自己的账户获得普通用户权限，在执行一些操做时，将隐藏表单中标识自己的账号改为他人的账号，从而未授权访问执行其他用户的操做）

### 边界确认
- 边界确认(boundary validation)是一种更加有效的模型。此时，服务器应用程序的每一个单独组件或功能单元将其输入当做来自潜在恶意来源的输入对待。除客户端与服务器至今啊的外部边界外，应用程序在上述每一个信任边界上执行数据确认。


### 多步确认与规范化

## 处理攻击者
- 为处理攻击者而采取的措施一般由以下任务组成
  - 处理错误
  - 维护审计日志
  - 向管理员发出报警
  - 应对攻击

### 处理错误
- 在生产环境下，应用程序不应在其响应中返回任何系统生成的消息或其他调试信息


## 管理应用程序
- 许多应用程序一般通过相同的Web界面在内部执行管理功能，这也是它的核心非安全功能。在这种情况下，管理机制就成为应用程序的主要受攻击面，它吸引攻击者的地方在于它能够提升权限。