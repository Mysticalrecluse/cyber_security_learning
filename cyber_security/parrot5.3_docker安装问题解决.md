# Parrot5.3安装docker过程中的问题（新手可看）
## 网络配置
- 网络适配器：桥接模式（推荐）
  - 使用桥接模式时，虚拟机将直接连接到主机所在的物理网络，就像它是网络上的另一台独立的计算机。因此，你可以很容易地从主机或网络上的其他任何设备访问它（即虚拟机和物理机在同一网段）
- 网络适配器：NAT模式（麻烦，不推荐）
  - 当你在虚拟机（VM）中使用NAT（网络地址转换）模式，虚拟机和主机之间的网络是隔离的。这意味着虚拟机不会被分配到与主机同一网络段的IP地址。
  - 解决方案：
    - 端口转发
      - 将主机的端口映射到某个虚拟机上的端口，通过端口映射实现，在vmware的虚拟网络编辑器中进行端口转发的调整
    - 静态路由
      - 可以在主机上添加一条静态路由，使其知道如何到达虚拟机的子网

- 桥接模式下的网络配置
  ```shell
  更改网卡名为eth0

  $ vim /etc/default/grub
  # 进入文件，更改这行：GRUB_CMDLINE_LINUX="net.ifnames=0"，后退出保存
  $ grub -mkconfig -o /boot/grub/grub.cfg
  # 执行之后重启即可

    --------------------------------------------------------------

  更改网卡ip

  $ /etc/network/interfaces.d      #进入interfaces目录下
  $ touch eth0                     #手动创建一个eth0文件
  
  # eh0 文件内的内容
  auto eth0
  iface eth0 inet static            # static选择静态网卡
    address 192.168.0.99            # 自行配置网路ip，要求和主机同一网段
    netmask 255.255.255.0           # 同上，可查询主机ipconfig得知信息（如果主机是windows系统）
    gateway 192.168.0.1             # 查询主机网络信息，默认网关
    dns-nameservers 8.8.8.8 8.8.4.4 114.114.114.114
    # dns可以是移动公网：114.114.114.114 谷歌公网：8.8.8.8，8.8.4.4都可以

  保存后退出

    ----------------------------------------------------------------

  添加DNS配置文件

  $ vim /etc/resolv.conf

  # resolv.conf文件内容
     # Generated by NetworkManager
    nameserver 192.168.0.1    # 本机DNS
    nameserver 8.8.8.8         # 谷歌DNS
    nameserver 8.8.4.4
    nameserver 114.114.114.114  #移动DNS

  保存后退出
  重启网络服务
  $ systemctl restart networking
  # 也可以reboot重启，简单粗暴

  检测是否能连上网络
  $ ping baidu.com
  
  ```
## 软件包源的更换
- 禁用之前的parrot本身的软件源
```shell
配置文件地址：
/etc/apt/source.list

# 将之前的外网的源注释掉，添加国内源

#deb https://deb.parrot.sh/parrot lts main contrib non-free
#deb-src https://deb.parrot.sh/parrot lts main contrib non-free
deb https://mirrors.aliyun.com/parrot/ parrot main contrib non-free
deb-src https://mirrors.aliyun.com/parrot/ parrot main contrib non-free

将/etc/apt/sourcd.list.d/parrot.list 这个文件备份后删除，添加其他源 *.list

```
- 添加备用国内源

```shell

阿里云（aliyun.list）：

deb https://mirrors.aliyun.com/debian/ bullseye main non-free contrib
deb-src https://mirrors.aliyun.com/debian/ bullseye main non-free contrib
deb https://mirrors.aliyun.com/debian-security/ bullseye-security main
deb-src https://mirrors.aliyun.com/debian-security/ bullseye-security main
deb https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib
deb-src https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib
deb https://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib
deb-src https://mirrors.aliyun.com/debian/ bullseye-backports main non-free contrib

```
```shell

清华源（qinghua_debian.list）:

# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware

deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware

deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware

# deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
# # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware

deb https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware
# deb-src https://security.debian.org/debian-security bookworm-security main contrib non-free non-free-firmware

```
## 安装docker
### 安装存储库 
- 设置存储库
  - 更新软件包索引并安装软件包以允许使用 基于 HTTPS 的存储库
  
    ```
    $ sudo apt-get update
    $ sudo apt-get install ca-certificates curl gnupg
    ```
  - 添加 Docker 的官方 GPG 密钥：
  
    ```
    sudo install -m 0755 -d /etc/apt/keyrings
    $ curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
    $ sudo chmod a+r /etc/apt/keyrings/docker.gpg
    ```
  - 使用以下命令设置存储库：
  
    ```
    $ echo \
    "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
    "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \
    sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```
### apt源和公钥不统一问题
- 按上述官方步骤，由于该指令的存储库，最后生成的dockers.list的文件中，debian的版本是ara，与实际版本不符，需要手动更改文件内的版本为正确版本
- 但是版本更改后，又与之前的官方GPG公钥不符，更改GPG公钥，又会自动更改版本号
- 因此需要以下步骤解决上述问题
  - 先添加GPG密钥：运行以下命令以添加Docker的GPG密钥：
  ```
  curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
  ```
  - 手动指定对应版本的docker apt源 (重点)
  ```
  echo "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian bullseye stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

  ```

  - 最后更新apt索引
  ```shell
  sudo apt-get update  # 大功告成
  ```

### 安装docker-ce引擎
- 安装docker-ce
    ```
    sudo apt-get install docker-ce
    ```

- 设置开启自启和启动
    ```
    sudo systemctl enable docker
    sudo systemctl start docker
    ```