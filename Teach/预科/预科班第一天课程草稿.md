# 什么是运维，即运维的基本职责
运维工程师的基本职责就是保障系统和服务的稳定性，稳定性压倒一切，确保服务一年365天，24小时不间断的为用户提供服务，总的来说就是让“系统跑的快，跑的稳，跑的安全”。

## 运维工程师的核心职责
### 系统管理
- 安装、配置和管理操作系统(如Linux、Windows)
- 保证服务器的高可用性和性能
- 案例
  - 你负责维护一个购物网站。为了保证用户在大促期间（如“双十一”）购物体验流畅，你需要在活动开始前检查"服务器资源"是否足够，并添加临时服务器，避免访问高峰导致网站崩溃。

### 网络管理
- 管理和优化网络设备，如路由器，交换机，防火墙
- 设计合理的网络架构，保证数据流畅传输
- 案例
  - 某公司多地分布办公，员工经常抱怨访问文件太慢。作为运维工程师，你通过优化网络路径或搭建本地缓存服务器，让文件访问速度大幅提升。

### 应用部署和维护
- 将开发完成的应用程序部署到服务器上，确保服务稳定运行。
- 解决因应用更新导致的故障。
- 案例
  - 某开发团队更新了一个功能，但用户反馈功能无法使用。你发现问题出在配置文件格式更新不兼容，于是调整配置后解决了问题。

### 监控和故障处理
- 监控系统和服务运行状态，及时发现异常。
- 当故障发生时，快速定位并修复问题，尽量减少对用户的影响。
- 案例
  - 一天深夜，你接到报警，发现公司官网无法访问。通过日志分析，你发现是磁盘空间耗尽导致服务中断，删除临时文件并扩容磁盘后恢复了服务。

### 数据备份与恢复
- 定期备份数据，防止因硬件损坏或黑客攻击造成数据丢失
- 制定灾备计划，确保意外发生时能快速恢复服务。
- 案例
  - 某天服务器被勒索病毒攻击，你迅速启用之前的备份，恢复了网站数据，避免了公司巨额损失。

### 安全管理
- 防御网络攻击，如DDoS攻击
- 定期进行安全审计，发现并修补漏洞
- 案例
  - 公司收到警报，有外部IP正在试图暴力破解后台密码。你立即设置防火墙规则，封禁了可疑IP，同时引入双因素认证，提升了系统安全性。




在此基础上运维工程师的工作内容还有很多：
- 提升效率：使用自动化的平台或工具，来提升项目在研发生命周期内的效率
- 控制成本：通过技术手段对服务架构进行优化，或采用新的产品或技术，来达到降低成本，提升效益的作用
- 发布管理：构建自动化运维平台，来确保每次发版都安全可控
```
现代运维工程师在发布管理中的工作内容可以看作是CI/CD(持续集成与持续交付)的实际应用。

持续集成 (CI - Continuous Integration)
持续集成是一种开发实践，指的是将团队中每位开发者的代码变更频繁地集成到主干中，并在每次集成后通过自动化工具执行代码构建和测试。

运维工程师的角色：
1. 搭建和维护代码仓库（如Git、GitLab）
2. 配置持续集成工具（如Jenkins）
3. 编写自动化脚本：实现代码拉取、依赖安装、单元测试和打包。
...

持续交付（CD - Continuous Delivery）
持续交付是在持续集成的基础上自动化整个发布过程，使得软件随时可以交付到生产环境。但部署到生产环境的决策通常需要人工确认。

运维工程师的角色：
写发布流水线脚本：自动完成打包、生成镜像、上传到制品仓库（harbor）。
设计灰度发布或蓝绿部署策略：减少发布对生产环境的影响。
管理自动化测试：包括集成测试、回归测试、UI测试等。
配置制品管理工具：如Nexus，用于存储和分发编译产物。

实际案例：
当代码通过持续集成的所有测试后，自动触发交付流程：
1. 打包应用
2. 构建Docker镜像
3. 将镜像上传到镜像仓库
4. 将测试版本部署到预发布环境，运行测试
通常运维工程师会验证发布环境的稳定性，人工确认后允许进入生产环境。

持续部署(CD-Continuous Deployment) ?
持续部署是持续交付的进一步延伸：代码的变更一旦通过自动化测试，即可自动部署到生产环境，完全不需要人工干预。

主要目标：
1. 最大化自动化程度
2. 实现极快速的迭代交付
3. 减少发布周期

运维工程师的角色
1. 保障生产环境的稳定性，设计回滚机制，确保自动化部署失败时能快速恢复。
2. 实施监控与报警：实时监控应用的健康状态（如Prometheus、Grafana）
3. 优化部署流程：实现零停机部署或分布式系统的分批部署

实际案例
1. 每次代码变更后，Jenkins自动执行从代码到生产的完整流程
- 测试
- 构建镜像
- 部署到Kubernetes集群
2. 部署完成后，运维工具自动验证服务是否正常运行

总结：CI/CD与运维工程师的工作关系
持续集成（CI）
- 核心工作是“代码集成与质量保证”，为代码流动的高效性奠定基础。
- 使用自动化工具（如Jenkins）实现从代码拉取到单元测试的过程。
持续交付（CD - Delivery）
- 核心工作是**“交付的自动化与稳定性”**，确保软件能随时发布到生产环境
- 涉及构建制品、预发布测试、灰度发布等流程。
持续部署（CD - Deployment）
- 核心工作是**“高效、稳定地自动部署到生产”**。
- 高度依赖自动化，运维工程师需要设计容错机制与监控体系。
```

- 变更管理：通过技术手段，对每次变更都要记录在案，有迹可循。
```
现代变更管理的核心理念
1. 自动化是基础：尽量减少手工变更操作
2. 可观测性是保障：实时监控系统状态，快速定位并修复问题
3. 快速恢复是关键：即使变更引发故障，也能快速回滚或恢复
```
- 备份恢复：对重要数据采用定时备份机制，以便能在发生问题时能及时恢复数据
```shell
定时任务crontab
使用Percona XtraBackup工具备份数据库
```
- 灾难演练：定期对预定义方案进行演练，确保是可行的
```shell
针对某个关键服务(如：数据库或缓存)进行故障模拟
- 数据库主从切换

数据丢失演练
- 检查备份的有效性
示例：
- 恢复某个时间点的MySQL数据
```
- 系统分析：通过采集并分析各类日志，定位并分析出系统可能存在的风险，及时修正，以及做好预案
```shell
使用监控工具对整个系统进行监控，进行数据采集和日志采集，并汇总进行分析
Zabbix，Prometheus，ELK
```
- 技术选型：根据当前服务的业务情况，选用不同的产品和架构，已达到业务与经济平衡
......

