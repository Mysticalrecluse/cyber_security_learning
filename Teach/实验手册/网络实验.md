# 实验1：修改网卡名

**如何查看引导方式是BIOS还是UEFI**

查看是否存在 EFI 目录（最常用、最快）

```bash
[root@magedu ~]# ls /sys/firmware/efi
ls: cannot access '/sys/firmware/efi': No such file or directory
```

- 有输出或目录存在 → ✅ **UEFI 引导**
- 无此目录（提示不存在） → ✅ **BIOS（Legacy）引导**





**在确定 启动项管理方式 和 系统启动方式 后，网卡名的更改如下**

```bat
# 使用BLS启动项管理方式的，禁用BLS。统一grub管理
sed -i 's/GRUB_ENABLE_BLSCFG=true/GRUB_ENABLE_BLSCFG=false/' /etc/default/grub

# 修改 /etc/default/grub中的 GRUB_CMDLINE_LINUX
在 GRUB_CMDLINE_LINUX 中添加 net.ifnames=0 biosdevname=0 即可

# 使用 /etc/default/grub 生成启动项配置文件 grub.cfg
# 如果启动方式是BIOS
Rocky： grub2-mkconfig -o /boot/grub2/grub.cfg
Ubuntu：grub-mkconfig -o /boot/grub/grub.cfg

# 如果启动方式是UEFI
Rocky： grub2-mkconfig -o /boot/efi/EFI/<发行版>/grub.cfg
Ubuntu：grub-mkconfig -o /boot/efi/EFI/<发行版>/grub.cfg

# 更改后重启
reboot
```





# 实验2：配置静态IP

## Rocky

操作流程：修改配置文件 -> 启用配置文件（`Systemctl restart NetworkManager` 或  `nmcli conn reload && nmcli conn up eth0`）

> **nmcli：NetworkManager Command Line Interface** 的缩写



**兼容性说明：**

| 系统版本      | 默认方式                         | 是否兼容 ifcfg-* | 建议           |
| ------------- | -------------------------------- | ---------------- | -------------- |
| CentOS 7      | NetworkManager + network-scripts | ✅                | 可继续使用脚本 |
| Rocky 8       | NetworkManager + 脚本兼容模式    | ✅                | 逐步过渡       |
| Rocky 9/RHEL9 | NetworkManager + `.nmconnection` | ⚠️（部分兼容）    | 推荐全面迁移   |



 **NetworkManager 的配置源**

- `/etc/sysconfig/network-scripts/ifcfg-*`
- `/etc/NetworkManager/system-connections/*.nmconnection`



**NetworkManager 处理机制：**

- 启动时，**会自动读取两类配置文件**（除非被显式禁用）：
  - `/etc/sysconfig/network-scripts/` 下的 `ifcfg-*`
  - `/etc/NetworkManager/system-connections/` 下的 `.nmconnection`
- 如果同时存在，**`.nmconnection` 更优先**，并会尝试忽略 legacy `ifcfg-*` 文件，除非你开启了兼容模式（`ifcfg-rh` 插件）



##### ifcfg-eth0文件

```ini
NAME=eth0
DEVICE=eth0
BOOTPROTO=static
IPADDR=10.0.0.100
PREFIX=24
GATEWAY=10.0.0.2
DNS1=8.8.8.8
ONBOOT=yes
```



##### nmconnection文件

```ini
[connection]
id=eth0
type=ethernet
interface-name=eth0
autoconnect=true

[ipv4]
method=manual
addresses=10.0.0.100/24,10.0.0.2
dns=223.6.6.6;114.114.114.114;
dns-search=
ignore-auto-dns=true                       # 忽略 DHCP 服务器分配的 DNS 地址;避免 DHCP 动态获取的 DNS 覆盖你自己设置的 DNS
may-fail=false

[ipv6]
method=ignore             # 禁用ipv6
```



##### 修改配置文件后立即生效

```bat
nmcli connection reload                     # 重新加载配置
nmcli connection up eth0                    # 激活 eth0 配置
```



## Ubuntu

##### 配置文件范例

```yaml
network:
  version: 2
  renderer: networkd         # 或者NetworkManager
  ethernets:
    eth0:
      dhcp4: no
      addresses:
        - 10.0.0.100/24
      routes:
        - to: default
          via: 10.0.0.2
      nameservers:
        addresses:
          - 223.6.6.6
          - 114.114.114.114
```

```bash
netplan apply    # 重载网卡配置
```









# 实验3：软路由实验

按下列图例配置软路由使 `A服务器` 和 `B服务器` 可以成功通信

![image-20250817224928307](D:\git_repository\cyber_security_learning\markdown_img\image-20250817224928307.png)



```bash
[root@ubuntu2204 ~]#route add -net 192.168.20.0/24 gw 10.0.0.88 dev eth0

[root@ubuntu2204 ~]#route add -net 192.168.20.0/24 gw 10.0.10.66 dev eth1

[root@ubuntu2204 ~]#route add -net 10.0.0.0/24 gw 10.0.10.6 dev eth0

[root@ubuntu2204 ~]#route add -net 10.0.0.0/24 gw 192.168.20.0 dev eth1

[root@ubuntu2204 ~]#echo 1 > /proc/sys/net/ipv4/ip_forward

[root@ubuntu2204 ~]#echo 1 > /proc/sys/net/ipv4/ip_forward
```

