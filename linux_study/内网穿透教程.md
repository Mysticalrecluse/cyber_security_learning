# å†…ç½‘ç©¿é€æ•™ç¨‹



## SSHå†…ç½‘ç©¿é€

### æ•´ä¸ªæ•°æ®åŒ…é€šä¿¡è¿‡ç¨‹ï¼ˆåˆ†é˜¶æ®µè¯¦ç»†è®²è§£ï¼‰

#### é˜¶æ®µä¸€ï¼šéš§é“å»ºç«‹

**ä¸»åŠ¨ç«¯ï¼šå†…ç½‘å®¢æˆ·ç«¯ `10.0.0.201`**

1. ä½ åœ¨å†…ç½‘ä¸»æœºä¸Šæ‰§è¡Œ `ssh -fN -R 11223:localhost:22 root@101.35.250.82`
2. è¯¥å‘½ä»¤ï¼š
   - å‘èµ· SSH TCP è¿æ¥ï¼š**`10.0.0.201:22 â†’ 101.35.250.82:11223`**
   - SSH è¿æ¥å»ºç«‹æˆåŠŸåï¼Œåœ¨è¿œç¨‹ä¸»æœºä¸Šç»‘å®šç›‘å¬ï¼š`0.0.0.0:11223`
   - SSH å®ˆæŠ¤è¿›ç¨‹å¼€å§‹ç›‘å¬å¤–éƒ¨å¯¹ `11223` çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶å‡†å¤‡å°†è¿™äº›æµé‡é€šè¿‡éš§é“è½¬å‘å›æ¥

ğŸ‘‰ ç»“æœï¼š**å…¬ç½‘æœåŠ¡å™¨ `101.35.250.82` å¼€å§‹ç›‘å¬ 11223**ï¼Œä½œä¸ºè¿›å…¥å†…ç½‘çš„å…¥å£



#### é˜¶æ®µäºŒï¼šå¤–éƒ¨å®¢æˆ·ç«¯è®¿é—®å…¬ç½‘æœåŠ¡å™¨

**å¤–éƒ¨ä»»æ„ä¸€å°å…¬ç½‘ä¸»æœºï¼šæ¯”å¦‚ `222.222.222.222`**

1. ç”¨æˆ·æ‰§è¡Œå‘½ä»¤ï¼š

   ```bash
   ssh -p 11223 user@101.35.250.82
   ```

2. å»ºç«‹ TCP è¿æ¥ï¼š

   ```makefile
   222.222.222.222:yyyyy â†’ 101.35.250.82:11223
   ```

3. å…¬ç½‘æœåŠ¡å™¨æ¥æ”¶åˆ°è¿æ¥åï¼Œå°†å…¶è®¤ä¸ºæ˜¯è¿æ¥æœ¬åœ°çš„ `11223`ï¼Œäºæ˜¯å°†å…¶ï¼š

   - **æ‰“åŒ…æˆ SSH éš§é“ payload**
   - ä» `101.35.250.82` çš„ç°æœ‰ SSH è¿æ¥**å°è£…å‘é€ç»™ 10.0.0.201ï¼ˆä½ çš„å†…ç½‘ï¼‰**



#### é˜¶æ®µä¸‰ï¼šSSH æœåŠ¡å™¨åå‘è½¬å‘æ•°æ®åˆ°å†…ç½‘ç›®æ ‡

**åå‘æµåŠ¨çš„ TCP payload åˆ°è¾¾å†…ç½‘**

1. å…¬ç½‘æœåŠ¡å™¨å°†æ”¶åˆ°çš„æ•°æ®æ‰“åŒ…ï¼Œæ”¾å…¥å·²å»ºç«‹çš„ SSH éš§é“è¿æ¥

2. åœ¨éš§é“å¦ä¸€ç«¯ï¼ˆ`10.0.0.201`ï¼‰ï¼š

   - `ssh` å®¢æˆ·ç«¯è§£æ payloadï¼Œå‘ç°æ˜¯å¯¹ `localhost:22` çš„è®¿é—®è¯·æ±‚

   - æœ¬åœ°å¼€å¯ä¸€ä¸ª TCP è¿æ¥ï¼š

     ```makefile
     localhost:zzzzz â†’ localhost:22
     ```

3. å°† payload è½¬å‘ç»™æœ¬åœ° SSH æœåŠ¡ï¼ˆç›¸å½“äºå¤–éƒ¨ç”¨æˆ·è¿æ¥äº† `10.0.0.201:22`ï¼‰



#### é˜¶æ®µå››ï¼šå†…ç½‘è¿”å›æ•°æ®å›ä¼ 

1. å†…ç½‘æœºå™¨ `10.0.0.201` çš„ `sshd` å“åº”æ•°æ®ï¼Œå†™å› TCP socket
2. æ•°æ®è¢« `ssh` å®¢æˆ·ç«¯å°è£…ï¼Œé€šè¿‡éš§é“åå‘å‘é€åˆ° `101.35.250.82`
3. å…¬ç½‘æœåŠ¡å™¨å°†è§£å°çš„æ•°æ®å†™å›åˆ°åŸå§‹å®¢æˆ·ç«¯ TCP è¿æ¥ `11223`

æœ€ç»ˆï¼š

```css
[å…¬ç½‘å®¢æˆ·ç«¯] â†â†’ 101.35.250.82:11223 â†â†’ SSH éš§é“ â†â†’ 10.0.0.201:22
```



#### å›¾ç¤ºæ€»ç»“ï¼ˆæ•°æ®åŒ…æ–¹å‘ï¼‰

```css
     â¬‡ï¸ TCP: 222.222.222.222:YYYY â†’ 101.35.250.82:11223
å…¬ç½‘å®¢æˆ·ç«¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ å…¬ç½‘è·³æ¿æœº
                                                  â”‚
             SSHéš§é“                              â–¼
å…¬ç½‘è·³æ¿æœº â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TCP Payload over SSH â”€â”€â”€â”€â”€â”€â”€â”€ å†…ç½‘æœºå™¨
       â¬…ï¸ å›åº”æ•°æ®ï¼š10.0.0.201:22 â†’ 101.35.250.82 â†’ 222.222.222.222
```



#### è¡¥å……è¯´æ˜ï¼šä¸ºä»€ä¹ˆèƒ½ç©¿é€ NATï¼Ÿ

å› ä¸ºï¼š

- å†…ç½‘æœºå™¨æ˜¯ä¸»åŠ¨å‘èµ· SSH è¿æ¥ï¼ˆå…è®¸å‡ºç«™ NATï¼‰
- SSH éš§é“å»ºç«‹åï¼Œæ‰€æœ‰æµé‡éƒ½é€šè¿‡è¿™ä¸ªåå‘è¿æ¥å›æµ
- æ— éœ€å…¬ç½‘ IPï¼ŒNAT ä¸é˜»æ­¢ TCP å›ç¨‹







## ä¸­å¾®å­ä»£ç†å†…ç½‘ç©¿é€

![image-20250821091521996](../markdown_img/image-20250821091521996.png)



### åŸç†è§£è¯»

- **ä¸‰è§’è‰²**ï¼šå…¬ç½‘çš„ **NPS æœåŠ¡ç«¯ï¼ˆnpsï¼‰**ã€å†…ç½‘çš„ **NPS å®¢æˆ·ç«¯ï¼ˆnpcï¼‰**ã€ä»¥åŠçœŸæ­£è®¿é—®ä½ çš„â€œå¤–éƒ¨ç”¨æˆ·/æµè§ˆå™¨/SSH å®¢æˆ·ç«¯â€ç­‰ã€‚
- **é•¿è¿æ¥æ§åˆ¶é€šé“**ï¼šå†…ç½‘ `npc` ä¸»åŠ¨å‘å…¬ç½‘ `nps` å‘èµ· **å¤–è¿**ï¼ˆé»˜è®¤ TCPï¼Œäº¦å¯ TLS/WS/KCP ç­‰ï¼‰ï¼Œç©¿è¿‡ NAT/é˜²ç«å¢™å¹¶é•¿æœŸä¿æŒå¿ƒè·³ã€‚
- **æ•°æ®è½¬å‘**ï¼šå½“å¤–éƒ¨ç”¨æˆ·è®¿é—® `nps` ä¸Šçš„æŸä¸ªâ€œæ˜ å°„â€ï¼ˆç«¯å£/åŸŸåï¼‰æ—¶ï¼Œ`nps` åœ¨å·²æœ‰çš„æ§åˆ¶é€šé“ä¸Šå‘ `npc` ä¸‹å‘æŒ‡ä»¤ï¼Œå»ºç«‹/å¤ç”¨ **æ•°æ®é€šé“**ï¼ŒæŠŠå…¬ç½‘æ¥çš„æµé‡è½¬åˆ° `npc`ï¼Œå†ç”± `npc` è¿æ¥ **å†…ç½‘ç›®æ ‡æœåŠ¡**ï¼ˆå¦‚ `127.0.0.1:22` / `10.0.0.5:8080`ï¼‰ï¼Œåš**åŒå‘å­—èŠ‚è½¬å‘**ã€‚
- **å¤ç”¨**ï¼šåŒä¸€æ¡æ§åˆ¶è¿æ¥ä¸Šå¯åŒæ—¶æ‰¿è½½å¤šä¸ªå¤–éƒ¨ä¼šè¯ï¼ˆå¤šè·¯å¤ç”¨/å¤šè·¯å¹¶å‘ï¼‰ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€ã€‚
- **HTTP/HTTPS æŒ‰åŸŸååˆ†å‘**ï¼š`nps` å¯ç›´æ¥ç›‘å¬ 80/443ï¼ŒæŒ‰ Host/SNI æŠŠä¸åŒåŸŸååˆ†å‘åˆ°ä¸åŒ `npc` çš„ä¸åŒåç«¯ï¼›æ”¯æŒè‡ªåŠ¨åŠ  `X-Forwarded-For` ç­‰ä¿ç•™çœŸå®æ¥æºã€‚
- **æƒé™ä¸é™æµ**ï¼šç”¨ vkey/è´¦å·ç®¡ç†ã€ç«¯å£ç™½åå•ã€å¸¦å®½/å¹¶å‘é™åˆ¶ç­‰ï¼Œé¿å…â€œé‡æ˜ å°„â€ã€‚

> æ³¨æ„ï¼šè¿™ç±»â€œå†…ç½‘ç©¿é€â€æ˜¯**åå‘ä»£ç†å‹**ç©¿é€â€”â€”ä¸æ˜¯æ‰“æ´åš P2Pï¼›å¤–éƒ¨è¿æ¥å§‹ç»ˆå…ˆåˆ°è¾¾å…¬ç½‘ `nps` å†è½¬å‘åˆ° `npc`ã€‚





### å…¸å‹éƒ¨ç½²æ‹“æ‰‘

```bat
[å¤–éƒ¨ç”¨æˆ·] â‡„ äº’è”ç½‘ â‡„ [NPS æœåŠ¡ç«¯ï¼šå…¬ç½‘IP]
                                  â”‚
                 æ§åˆ¶/æ•°æ®é€šé“ â‡„  â”‚  (å¦‚ TCP 8024/TLS/WSS)
                                  â”‚
                           [å†…ç½‘ npc å®¢æˆ·ç«¯] â”€â”€â–º ç›®æ ‡æœåŠ¡
                                 (10.0.0.x:22 / 127.0.0.1:8080 ...)
```







### ä½¿ç”¨dockerå®¹å™¨åŒ–éƒ¨ç½²

#### éƒ¨ç½²æœåŠ¡ç«¯

- dockerHubé•œåƒåœ°å€ï¼š`aoshiguchen/neutrino-proxy-server:latest`
- é˜¿é‡Œäº‘é•œåƒåœ°å€ï¼š`registry.cn-hangzhou.aliyuncs.com/asgc/neutrino-proxy:latest`





#### ä½¿ç”¨é»˜è®¤h2æ•°æ®åº“ä¸€é”®éƒ¨ç½²

```bash
docker run -it -p 9000-9200:9000-9200/tcp -p 8888:8888 \
-d --restart=always --name neutrino-proxy \
-v /root/neutrino-proxy-server/config:/root/neutrino-proxy/config \
-v /root/neutrino-proxy-server/data:/root/neutrino-proxy/data \
-v /root/neutrino-proxy-server/logs:/root/neutrino-proxy/logs \
aoshiguchen/neutrino-proxy-server:latest
```





#### æŒ‡å®šè‡ªå·±çš„mysqlæ•°æ®åº“

- åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•ï¼š`/root/neutrino-proxy/config`
- åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º`app.yml`æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶é…ç½®å¦‚ä¸‹å†…å®¹ï¼š

```mysql
# åˆ›å»ºåä¸ºneutrino-proxyçš„æ•°æ®åº“
create database `neutrino-proxy`

# åˆ›å»ºç”¨æˆ·
CREATE USER 'neutrino'@'localhost' IDENTIFIED BY 'StrongPwd!123';
GRANT ALL PRIVILEGES ON `neutrino-proxy`.* TO 'neutrino'@'localhost';
FLUSH PRIVILEGES;
```



```yaml
neutrino:
  data:
    db:
      type: mysql
      # è‡ªå·±çš„æ•°æ®åº“å®ä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„åä¸º'neutrino-proxy'çš„æ•°æ®åº“å³å¯ï¼Œé¦–æ¬¡å¯åŠ¨æœåŠ¡ç«¯ä¼šè‡ªåŠ¨åˆå§‹åŒ–
      url: jdbc:mysql://xxxx:3306/neutrino-proxy?useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true&useAffectedRows=true&useSSL=false
      driver-class: com.mysql.jdbc.Driver
      # æ•°æ®åº“å¸å·
      username: neutrino
      # æ•°æ®åº“å¯†ç 
      password: localhost
```

> ç„¶åå†æ‰§è¡Œä¸Šé¢çš„dockerä¸€é”®éƒ¨ç½²å‘½ä»¤å³å¯





#### éƒ¨ç½²å®¢æˆ·ç«¯

- dockerHubé•œåƒåœ°å€ï¼šaoshiguchen/neutrino-proxy-client:latest
- é˜¿é‡Œäº‘é•œåƒåœ°å€ï¼šregistry.cn-hangzhou.aliyuncs.com/asgc/neutrino-proxy-client:latest
- å‘½ä»¤ä¸­çš„æœåŠ¡ç«¯ipã€licenseè¯·è‡ªè¡Œè¡¥å……
- è‹¥æ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œè¯·ä»”ç»†é˜…è¯»å¿«é€Ÿä¸Šæ‰‹ï¼Œä»¥ç¡®å®šlicenseä»å“ªé‡Œå–å¾—

```shell
docker run -it -d --restart=always --name npclient -e SERVER_IP=xxxx -e LICENSE_KEY=xxxx \
aoshiguchen/neutrino-proxy-client:latest
```





#### æµè§ˆå™¨æŸ¥çœ‹

- **é»˜è®¤ç”¨æˆ·å¯†ç **ï¼š`admin/123456`

![image-20250821092652111](../markdown_img/image-20250821092652111.png)



æŸ¥çœ‹ `License Key` åœ¨éƒ¨ç½²å®¢æˆ·ç«¯çš„æ—¶å€™ä½¿ç”¨

```bash
b0a907332b474b25897c4dcb31fc7eb6
```





### é…ç½®ç«¯å£æ˜ å°„

![image-20250821093128801](../markdown_img/image-20250821093128801.png)



```bat
æ³¨æ„ï¼šå…¬æœ‰äº‘çš„å®‰å…¨ç»„è¦å¼€æ”¾ç«¯å£ï¼Œå…¶ä¸­ 9000 å’Œ 9002 ä»¥åŠå¯¹åº”çš„æœåŠ¡ç«¯å£è¦å¼€æ”¾
```



