<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/24.2.5 Chrome/120.0.6099.109 Electron/28.1.0 Safari/537.36" modified="2025-08-22T10:04:11.251Z" etag="g2aDEZs-OotCMgtxUA3E" version="24.2.5" type="device">
  <diagram id="wrCdoQ_2FLhnvDLX_88F" name="第 1 页">
    <mxGraphModel dx="3175" dy="2740" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="_FFqBCeF78_xi2tW4rS6-34" style="edgeStyle=orthogonalEdgeStyle;curved=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="_FFqBCeF78_xi2tW4rS6-26" target="_FFqBCeF78_xi2tW4rS6-29" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-37" style="edgeStyle=orthogonalEdgeStyle;curved=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="_FFqBCeF78_xi2tW4rS6-26" target="_FFqBCeF78_xi2tW4rS6-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-42" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="_FFqBCeF78_xi2tW4rS6-26" target="tlIEBAkVMEHic_1Gy2fF-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-26" value="事件（&lt;b&gt;&lt;font color=&quot;#ff8000&quot;&gt;网络事件&lt;/font&gt;&lt;/b&gt;）驱动框架" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;align=center;strokeColor=#6c8ebf;fillColor=#dae8fc;" parent="1" vertex="1">
          <mxGeometry x="-184" y="-168" width="177" height="56" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-29" value="读事件（EPOLLIN）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="-248" y="-64" width="96" height="46" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-30" value="写事件（EPOLLOUT）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="-43" y="-64" width="96" height="46" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-52" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="86" y="-217" width="459" height="269" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-38" value="&lt;span style=&quot;font-size: 10px&quot;&gt;各种读事件（比如nginx接收请求）&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="_FFqBCeF78_xi2tW4rS6-52" vertex="1">
          <mxGeometry x="4.59" y="53.06802721088435" width="168.912" height="31.108843537414966" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-39" value="&lt;font style=&quot;font-size: 10px&quot;&gt;各种写事件（比如写回响应数据）&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="_FFqBCeF78_xi2tW4rS6-52" vertex="1">
          <mxGeometry y="166.52380952380952" width="173.502" height="31.108843537414966" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-40" value="事&lt;br&gt;件&lt;br&gt;收&lt;br&gt;集&lt;br&gt;分&lt;br&gt;发&lt;br&gt;器" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=12;fontColor=#000000;align=center;strokeColor=#6c8ebf;fillColor=#dae8fc;" parent="_FFqBCeF78_xi2tW4rS6-52" vertex="1">
          <mxGeometry x="223.074" width="27.540000000000003" height="269" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-47" style="edgeStyle=orthogonalEdgeStyle;curved=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-52" source="_FFqBCeF78_xi2tW4rS6-38" target="_FFqBCeF78_xi2tW4rS6-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-48" style="edgeStyle=orthogonalEdgeStyle;curved=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-52" source="_FFqBCeF78_xi2tW4rS6-39" target="_FFqBCeF78_xi2tW4rS6-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-49" value="&lt;span style=&quot;font-size: 10px&quot;&gt;每种事件都有对应的消费者进行处理&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="_FFqBCeF78_xi2tW4rS6-52" vertex="1">
          <mxGeometry x="290.088" y="113.91326530612245" width="168.912" height="41.173469387755105" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-51" style="edgeStyle=orthogonalEdgeStyle;curved=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-52" source="_FFqBCeF78_xi2tW4rS6-40" target="_FFqBCeF78_xi2tW4rS6-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-53" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="1571" y="-580" width="750" height="313" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-1" value="&lt;b&gt;&lt;font style=&quot;font-size: 15px&quot;&gt;Nginx&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontColor=#ffffff;" parent="_FFqBCeF78_xi2tW4rS6-53" vertex="1">
          <mxGeometry x="312.5" width="125.00000000000001" height="57.96296296296296" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-3" value="&lt;font style=&quot;font-size: 11px&quot;&gt;HTTP状态机&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="_FFqBCeF78_xi2tW4rS6-53" vertex="1">
          <mxGeometry x="318.1818181818182" y="127.51851851851852" width="113.63636363636364" height="46.37037037037037" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-53" source="_FFqBCeF78_xi2tW4rS6-1" target="_FFqBCeF78_xi2tW4rS6-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-5" value="&lt;font style=&quot;font-size: 11px&quot;&gt;TCP状态机&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="_FFqBCeF78_xi2tW4rS6-53" vertex="1">
          <mxGeometry x="142.04545454545456" y="127.51851851851852" width="113.63636363636364" height="46.37037037037037" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-11" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-53" source="_FFqBCeF78_xi2tW4rS6-1" target="_FFqBCeF78_xi2tW4rS6-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-6" value="&lt;font style=&quot;font-size: 11px&quot;&gt;MAIL状态机&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="_FFqBCeF78_xi2tW4rS6-53" vertex="1">
          <mxGeometry x="494.31818181818187" y="127.51851851851852" width="113.63636363636364" height="46.37037037037037" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-12" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="_FFqBCeF78_xi2tW4rS6-53" source="_FFqBCeF78_xi2tW4rS6-1" target="_FFqBCeF78_xi2tW4rS6-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-13" value="HTTP状态机详解" style="rounded=1;whiteSpace=wrap;html=1;container=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="_FFqBCeF78_xi2tW4rS6-53" vertex="1">
          <mxGeometry y="220.25925925925924" width="750.0000000000001" height="92.74074074074073" as="geometry">
            <mxRectangle x="387.5" y="260" width="115" height="40" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-15" value="&lt;font style=&quot;font-weight: normal ; font-size: 10px&quot;&gt;接受HTTP请求&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" parent="_FFqBCeF78_xi2tW4rS6-13" vertex="1">
          <mxGeometry x="17.045454545454547" y="21.73611111111111" width="102.27272727272728" height="49.26851851851852" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-16" value="&lt;font style=&quot;font-weight: normal ; font-size: 10px&quot;&gt;解析请求行和请求头&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" parent="_FFqBCeF78_xi2tW4rS6-13" vertex="1">
          <mxGeometry x="153.40909090909093" y="21.73611111111111" width="125.00000000000001" height="49.26851851851852" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-18" value="&lt;font style=&quot;font-weight: normal ; font-size: 10px&quot;&gt;检查请求体是否完整&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" parent="_FFqBCeF78_xi2tW4rS6-13" vertex="1">
          <mxGeometry x="301.1363636363637" y="21.73611111111111" width="125.00000000000001" height="49.26851851851852" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-20" value="&lt;font style=&quot;font-weight: normal ; font-size: 10px&quot;&gt;生成并发送响应&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" parent="_FFqBCeF78_xi2tW4rS6-13" vertex="1">
          <mxGeometry x="448.86363636363643" y="21.73611111111111" width="113.63636363636364" height="49.26851851851852" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-22" value="&lt;font style=&quot;font-weight: normal ; font-size: 10px&quot;&gt;完成请求处理，关闭连接&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1" parent="_FFqBCeF78_xi2tW4rS6-13" vertex="1">
          <mxGeometry x="585.2272727272727" y="21.73611111111111" width="147.72727272727275" height="49.26851851851852" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-17" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-13" source="_FFqBCeF78_xi2tW4rS6-15" target="_FFqBCeF78_xi2tW4rS6-16" edge="1">
          <mxGeometry x="22.72727272727273" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-19" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-13" source="_FFqBCeF78_xi2tW4rS6-16" target="_FFqBCeF78_xi2tW4rS6-18" edge="1">
          <mxGeometry x="22.72727272727273" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-21" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-13" source="_FFqBCeF78_xi2tW4rS6-18" target="_FFqBCeF78_xi2tW4rS6-20" edge="1">
          <mxGeometry x="22.72727272727273" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-23" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-13" source="_FFqBCeF78_xi2tW4rS6-20" target="_FFqBCeF78_xi2tW4rS6-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-24" style="edgeStyle=orthogonalEdgeStyle;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=none;curved=1;" parent="_FFqBCeF78_xi2tW4rS6-53" source="_FFqBCeF78_xi2tW4rS6-3" target="_FFqBCeF78_xi2tW4rS6-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_FFqBCeF78_xi2tW4rS6-25" style="edgeStyle=orthogonalEdgeStyle;curved=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="_FFqBCeF78_xi2tW4rS6-53" source="_FFqBCeF78_xi2tW4rS6-3" target="_FFqBCeF78_xi2tW4rS6-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--51" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--43" target="oCp0Jb_trErku0qVtbz--45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--53" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--43" target="oCp0Jb_trErku0qVtbz--46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--54" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--43" target="oCp0Jb_trErku0qVtbz--44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--55" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--43" target="oCp0Jb_trErku0qVtbz--47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--43" value="&lt;b&gt;&lt;font style=&quot;font-size: 15px&quot;&gt;Nginx模块&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="2787" y="151" width="110" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--66" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--44" target="oCp0Jb_trErku0qVtbz--64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--67" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--44" target="oCp0Jb_trErku0qVtbz--65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--44" value="&lt;b&gt;&lt;font style=&quot;font-size: 15px&quot;&gt;前提：编译进Nginx&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2226" y="273" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--61" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--45" target="oCp0Jb_trErku0qVtbz--57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--62" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--45" target="oCp0Jb_trErku0qVtbz--60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--45" value="&lt;b&gt;&lt;font style=&quot;font-size: 15px&quot;&gt;提供哪些配置项&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2652" y="273" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--46" value="&lt;b&gt;&lt;font style=&quot;font-size: 15px&quot;&gt;模块何时被使用&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="3272" y="273" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--47" value="&lt;b&gt;&lt;font style=&quot;font-size: 15px&quot;&gt;提供哪些变量&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="3596" y="273" width="155" height="50" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--57" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;查看官网&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2589.25" y="370" width="109" height="45" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--81" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--60" target="oCp0Jb_trErku0qVtbz--80" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--60" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;根据源码查看指定模块体提供哪些配置项&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2797" y="370" width="238" height="45" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--73" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--64" target="oCp0Jb_trErku0qVtbz--70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--74" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--64" target="oCp0Jb_trErku0qVtbz--69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--75" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--64" target="oCp0Jb_trErku0qVtbz--71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--64" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;编译模块&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2105" y="370" width="109" height="45" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--77" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--65" target="oCp0Jb_trErku0qVtbz--76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--65" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;查看是否编译成功&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2410.75" y="370" width="109" height="45" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--69" value="--with-XXX" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2014" y="470" width="89" height="42" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--70" value="--without-XXX" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2115" y="470" width="89" height="42" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--71" value="--add-module=XXX" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2216" y="470" width="118" height="42" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--79" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--76" target="oCp0Jb_trErku0qVtbz--78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--76" value="./configure XXX之后，查看&lt;b&gt;obj/ngx_modules.c&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="2341.25" y="470" width="248" height="44" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--78" value="&lt;b&gt;obj / nginx_modules.c&lt;/b&gt;中，有个数组&lt;br&gt;ngx_module_t *ngx_modules[ ] = {&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt;&amp;amp;ngx_core_module,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;ngx_errlog_module,&lt;br&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;amp;ngx_conf_module,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ......&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;}&amp;nbsp; // 这里是所有编译进Nginx中的模块&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=10;" parent="1" vertex="1">
          <mxGeometry x="2357.88" y="544" width="214.75" height="127" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oCp0Jb_trErku0qVtbz--80" target="oCp0Jb_trErku0qVtbz--82" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--80" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;以gzip模块为例：&lt;b&gt;&lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt;src/http/modules/ngx_http_gzip_filter_module.c&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="2771.5" y="467" width="289" height="45" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--82" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;搜索结构体：&lt;br&gt;static&lt;b&gt;&lt;font style=&quot;color: rgb(255, 0, 0);&quot;&gt; ngx_command_t&lt;/font&gt;&lt;/b&gt; ngx_http_gzip_filter_commands[ ] = { ... }；&lt;br&gt;// 上述结构体是一个数组，数组里的每个成员就是该模块支持的指令名&amp;nbsp;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;spacingLeft=13;" parent="1" vertex="1">
          <mxGeometry x="2693.75" y="557" width="444.5" height="111" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-46" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tlIEBAkVMEHic_1Gy2fF-41" target="tlIEBAkVMEHic_1Gy2fF-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-48" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tlIEBAkVMEHic_1Gy2fF-41" target="tlIEBAkVMEHic_1Gy2fF-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-50" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tlIEBAkVMEHic_1Gy2fF-41" target="tlIEBAkVMEHic_1Gy2fF-49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-41" value="事件的本质" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;fontStyle=1;fillColor=#d80073;strokeColor=#A50040;" parent="1" vertex="1">
          <mxGeometry x="-320" y="-163.5" width="91" height="47" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-44" value="&lt;span style=&quot;font-weight: normal;&quot;&gt;epoll 事件（network event）本质上是：内核检测到某个 fd（socket）的状态变化后，向用户空间通知“这个 fd 现在可以进行某种 I/O 操作（读/写）”&lt;br&gt;&lt;/span&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;br&gt;事件只是一个&lt;strong data-end=&quot;275&quot; data-start=&quot;265&quot;&gt;信号/元信息&lt;/strong&gt;，告诉你**“fd 已准备好”**，而不是携带具体数据。&lt;br&gt;&lt;/font&gt;&lt;span style=&quot;font-weight: normal;&quot;&gt;&lt;br&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="-776" y="-363" width="393" height="91.25" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-47" value="&lt;ul&gt;&lt;li data-end=&quot;164&quot; data-start=&quot;46&quot;&gt;&lt;p data-end=&quot;164&quot; data-start=&quot;48&quot;&gt;&lt;strong data-end=&quot;57&quot; data-start=&quot;48&quot;&gt;事件的本质&lt;/strong&gt;&lt;br data-end=&quot;60&quot; data-start=&quot;57&quot;&gt;&lt;br&gt;👉 &lt;strong data-end=&quot;119&quot; data-start=&quot;65&quot;&gt;是内核 epoll 的 &lt;code data-end=&quot;91&quot; data-start=&quot;79&quot;&gt;ready_list&lt;/code&gt; 链表中的节点（&lt;code data-end=&quot;116&quot; data-start=&quot;99&quot;&gt;epitem-&amp;gt;rdllink&lt;/code&gt;）&lt;/strong&gt;，&lt;br data-end=&quot;123&quot; data-start=&quot;120&quot;&gt;&lt;br&gt;这个节点表示&lt;strong data-end=&quot;149&quot; data-start=&quot;131&quot;&gt;某个 fd 当前处于就绪状态&lt;/strong&gt;（可读 / 可写 / 错误）。&lt;/p&gt;&lt;br&gt;&lt;/li&gt;&lt;li data-end=&quot;297&quot; data-start=&quot;166&quot;&gt;&lt;p data-end=&quot;297&quot; data-start=&quot;168&quot;&gt;&lt;strong data-end=&quot;186&quot; data-start=&quot;168&quot;&gt;&lt;code data-end=&quot;180&quot; data-start=&quot;170&quot;&gt;events[]&lt;/code&gt; 的作用&lt;/strong&gt;&lt;br data-end=&quot;189&quot; data-start=&quot;186&quot;&gt;&lt;br&gt;👉 只是 &lt;code data-end=&quot;211&quot; data-start=&quot;197&quot;&gt;epoll_wait()&lt;/code&gt; &lt;strong data-end=&quot;236&quot; data-start=&quot;212&quot;&gt;将 ready_list 里的事件元信息&lt;/strong&gt;（fd + event mask）&lt;br data-end=&quot;256&quot; data-start=&quot;253&quot;&gt;&lt;br&gt;&lt;strong data-end=&quot;269&quot; data-start=&quot;258&quot;&gt;复制到用户空间&lt;/strong&gt; 的一个 &lt;strong data-end=&quot;282&quot; data-start=&quot;274&quot;&gt;数组形式&lt;/strong&gt;，方便用户（Nginx）读取。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;" parent="1" vertex="1">
          <mxGeometry x="-827" y="-248.5" width="444" height="217" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-49" value="&lt;ul&gt;&lt;li data-end=&quot;164&quot; data-start=&quot;46&quot;&gt;&lt;h2 data-end=&quot;61&quot; data-start=&quot;35&quot;&gt;&lt;strong data-end=&quot;61&quot; data-start=&quot;40&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;事件类型由 socket 状态决定&lt;/font&gt;&lt;/strong&gt;&lt;/h2&gt;&lt;p data-end=&quot;142&quot; data-start=&quot;63&quot;&gt;在 epoll 中，&lt;strong data-end=&quot;119&quot; data-start=&quot;73&quot;&gt;事件类型（EPOLLIN / EPOLLOUT）完全取决于 socket 的当前状态&lt;/strong&gt;，而不是用户空间 Nginx 主动设置的标志。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;" parent="1" vertex="1">
          <mxGeometry x="-827" y="-18" width="444" height="112.5" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-63" value="&lt;div&gt;http/ngx_http_core_module.c&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ngx_module_t&amp;nbsp; ngx_http_core_module = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;amp;ngx_http_core_module_ctx,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module context */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ngx_http_core_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module directives */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt;NGX_HTTP_MODULE,&amp;nbsp;&lt;/font&gt;&lt;/b&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;/* module type */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init master */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init module */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init process */&lt;br&gt;......&lt;br&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="2703" y="1413.5" width="319" height="173.5" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--86" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;Nginx模块分类&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;labelBackgroundColor=none;fillColor=#008a00;strokeColor=#005700;" parent="1" vertex="1">
          <mxGeometry x="2621.5" y="763" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--88" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;NGX_CORE_MODULE&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#d80073;strokeColor=#A50040;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="2607.5" y="862" width="148" height="53" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-25" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--86" target="oCp0Jb_trErku0qVtbz--88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--89" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;NGX_EVENT_MODULE&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="3350" y="979.5" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-24" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--88" target="oCp0Jb_trErku0qVtbz--89" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--90" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;NGX_HTTP_MODULE&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2967" y="979.5" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-22" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--88" target="oCp0Jb_trErku0qVtbz--90" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--92" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;NGX_MAIL_MODULE&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="2606.5" y="975" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-20" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--88" target="oCp0Jb_trErku0qVtbz--92" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--93" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;NGX_STREAM_MODULE&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="2240.5" y="975" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-21" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--88" target="oCp0Jb_trErku0qVtbz--93" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-10" value="&lt;span style=&quot;font-size: 12px;&quot;&gt;NGX_CONF_MODULE&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="1860.5" y="975" width="150" height="50" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-23" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--88" target="tbstedJyYURACH70QP3b-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-26" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;core/ngx_conf_file.c-&amp;nbsp; &amp;nbsp;&amp;nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ngx_module_t&amp;nbsp; ngx_conf_module = {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module context */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; ngx_conf_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module directives */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt;NGX_CONF_MODULE&lt;/font&gt;&lt;/b&gt;,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;/* module type */&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init master */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; ......&lt;br&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="1769" y="1071" width="333" height="168" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-27" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-10" target="tbstedJyYURACH70QP3b-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-28" value="&lt;div&gt;&lt;div&gt;stream/ngx_stream.c:&lt;br&gt;&lt;/div&gt;&lt;div&gt;ngx_module_t&amp;nbsp; ngx_stream_module = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;amp;ngx_stream_module_ctx,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module context */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ngx_stream_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module directives */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt;NGX_CORE_MODULE,&lt;/font&gt;&lt;/b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;&amp;nbsp;/* module type */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init master */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init module */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init process */、&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ......&lt;br&gt;}&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="2152" y="1071" width="327" height="168" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-30" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--93" target="tbstedJyYURACH70QP3b-28" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-31" value="&lt;div&gt;mail/ngx_mail.c:&lt;br&gt;&lt;/div&gt;&lt;div&gt;ngx_module_t&amp;nbsp; ngx_mail_module = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;amp;ngx_mail_module_ctx,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module context */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ngx_mail_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module directives */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;&lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt; NGX_CORE_MODULE,&amp;nbsp;&lt;/font&gt;&lt;/b&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;/* module type */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init master */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init module */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init process */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ......&lt;br&gt;}&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="2531.5" y="1068.5" width="300" height="168" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-33" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--92" target="tbstedJyYURACH70QP3b-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-67" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-34" target="tbstedJyYURACH70QP3b-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-71" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-34" target="tbstedJyYURACH70QP3b-69" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-34" value="&lt;div&gt;http/ngx_http.c:&lt;br&gt;&lt;/div&gt;&lt;div&gt;ngx_module_t&amp;nbsp; ngx_http_module = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;amp;ngx_http_module_ctx,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module context */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ngx_http_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module directives */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt;NGX_CORE_MODULE,&lt;/font&gt;&lt;/b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;font color=&quot;#ff3333&quot;&gt;/* module type */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init master */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init module */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init process */&lt;br&gt;&amp;nbsp; &amp;nbsp; ......&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="2890" y="1070.5" width="304" height="173.5" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-35" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--90" target="tbstedJyYURACH70QP3b-34" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-36" value="&lt;div&gt;&lt;div&gt;ngx_module_t&amp;nbsp; ngx_events_module = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;amp;ngx_events_module_ctx,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module context */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ngx_events_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module directives */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt;NGX_CORE_MODULE,&lt;/font&gt;&lt;/b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;/* module type */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* init master */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ......&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="3254" y="1071.5" width="342" height="172.5" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-37" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="oCp0Jb_trErku0qVtbz--89" target="tbstedJyYURACH70QP3b-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-68" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-66" target="tbstedJyYURACH70QP3b-63" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-74" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-66" target="tbstedJyYURACH70QP3b-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-66" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;NGX_HTTP_ CORE_MUDULE&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="2766" y="1321" width="193" height="51" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-72" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-69" target="tbstedJyYURACH70QP3b-70" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-69" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;NGX_HTTP_ UPSTREAM_MUDULE&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="3121" y="1321" width="221" height="51" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-70" value="&lt;div&gt;ngx_module_t&amp;nbsp; ngx_http_upstream_module = {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NGX_MODULE_V1,&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;amp;ngx_http_upstream_module_ctx,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* module context */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ngx_http_upstream_commands,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* module directives */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;&lt;font color=&quot;#ff3333&quot;&gt;NGX_HTTP_MODULE,&lt;/font&gt;&lt;/b&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;font color=&quot;#ff3333&quot;&gt;/* module type */&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init master */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* init module */&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; ......&lt;br&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=17;" parent="1" vertex="1">
          <mxGeometry x="3059" y="1412.5" width="345" height="174.5" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-73" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;每个模块中会有一些通用的，共性的部分，通常是XX_core_mudole，会把通用的，共同具有的功能写在里面，index为1，也就是一定是第一位的&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" parent="1" vertex="1">
          <mxGeometry x="2440" y="1321" width="280" height="51" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-93" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-75" target="tbstedJyYURACH70QP3b-76" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-127" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-75" target="tbstedJyYURACH70QP3b-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-75" value="Nginx 连接池" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" vertex="1">
          <mxGeometry x="-319" y="2189" width="97" height="33" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-76" value="&lt;b style=&quot;border-color: var(--border-color); text-align: left;&quot;&gt;ngx_connection_t&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="-1194" y="2291" width="125" height="29" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-80" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-79" target="tbstedJyYURACH70QP3b-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-88" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-79" target="tbstedJyYURACH70QP3b-86" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-92" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-79" target="tbstedJyYURACH70QP3b-91" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-79" value="&lt;b&gt;NGX_CYCLE_T&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;fillColor=#6a00ff;strokeColor=#3700CC;" parent="1" vertex="1">
          <mxGeometry x="-142" y="1984" width="113" height="33" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-86" value="&lt;div&gt;&lt;b style=&quot;border-color: var(--border-color); text-align: center;&quot;&gt;core/ngx_core.h:typedef struct ngx_cycle_s&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;ngx_cycle_t;&lt;/b&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;typedef struct ngx_cycle_s {&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ngx_connection_t&amp;nbsp; &amp;nbsp;*connections;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 连接池数组&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ngx_event_t&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *read_events;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 读事件数组&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ngx_event_t&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; *write_events;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 写事件数组&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ngx_connection_t&amp;nbsp; &amp;nbsp;*free_connections;&amp;nbsp; // 空闲连接链表头&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ngx_uint_t&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; connection_n;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 连接池大小 (worker_connections)&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&amp;nbsp; &amp;nbsp; &lt;b&gt;ngx_pool_t&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 内存池&lt;/b&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; ...&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;} ngx_cycle_t;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;" parent="1" vertex="1">
          <mxGeometry x="-611" y="1916.5" width="420" height="168" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-131" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-91" target="tbstedJyYURACH70QP3b-129" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-133" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="1" source="tbstedJyYURACH70QP3b-91" target="tbstedJyYURACH70QP3b-130" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-91" value="Nginx 内存池" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;fillColor=#008a00;strokeColor=#005700;" parent="1" vertex="1">
          <mxGeometry x="1468" y="2189" width="97" height="33" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-124" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="-812" y="2291" width="1966.25" height="795" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-78" value="&lt;b&gt;事件触发与连接池分配的过程&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="624.75" width="161" height="29" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-94" value="客户端 → 服务器 TCP 三次握手" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="26.25" y="72" width="191" height="29" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-100" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=none;endFill=0;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-78" target="tbstedJyYURACH70QP3b-94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-95" value="epoll 事件触发" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="396.75" y="72" width="117" height="29" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-102" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-94" target="tbstedJyYURACH70QP3b-95" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-96" value="Nginx 处理 &lt;code data-end=&quot;323&quot; data-start=&quot;312&quot;&gt;listen_fd&lt;/code&gt; 事件" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="776.25" y="72" width="150" height="29" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-103" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-95" target="tbstedJyYURACH70QP3b-96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-97" value="连接池分配 &lt;code data-end=&quot;455&quot; data-start=&quot;437&quot;&gt;ngx_connection_t&lt;/code&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="1192.25" y="72" width="200" height="29" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-101" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=none;endFill=0;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-78" target="tbstedJyYURACH70QP3b-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-104" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-96" target="tbstedJyYURACH70QP3b-97" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-105" value="内核 TCP 栈完成握手 → &lt;code data-end=&quot;152&quot; data-start=&quot;141&quot;&gt;listen_fd&lt;/code&gt; 变为 &lt;strong data-end=&quot;171&quot; data-start=&quot;156&quot;&gt;可读（EPOLLIN）&lt;/strong&gt;。" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry y="142" width="243.5" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-108" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-94" target="tbstedJyYURACH70QP3b-105" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-109" value="&lt;ul style=&quot;line-height: 150%;&quot;&gt;&lt;li&gt;内核 TCP 栈完成握手 → &lt;code data-end=&quot;152&quot; data-start=&quot;141&quot;&gt;listen_fd&lt;/code&gt; 变为 &lt;strong data-end=&quot;171&quot; data-start=&quot;156&quot;&gt;可读（EPOLLIN）&lt;/strong&gt;。&lt;/li&gt;&lt;li&gt;&lt;code data-end=&quot;264&quot; data-start=&quot;250&quot;&gt;epoll_wait()&lt;/code&gt; 被唤醒 → &lt;strong data-end=&quot;295&quot; data-start=&quot;271&quot;&gt;拷贝事件到用户空间 &lt;code data-end=&quot;293&quot; data-start=&quot;283&quot;&gt;events[]&lt;/code&gt;&lt;/strong&gt;。&lt;/li&gt;&lt;/ul&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=0;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="272.25" y="142" width="366" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-111" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-95" target="tbstedJyYURACH70QP3b-109" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-112" value="&lt;ul style=&quot;line-height: 150%;&quot;&gt;&lt;li&gt;扫描 &lt;code data-end=&quot;349&quot; data-start=&quot;339&quot;&gt;events[]&lt;/code&gt; 发现 &lt;code data-end=&quot;364&quot; data-start=&quot;353&quot;&gt;listen_fd&lt;/code&gt; 触发可读 → 调用 &lt;code data-end=&quot;385&quot; data-start=&quot;375&quot;&gt;accept()&lt;/code&gt;；&lt;br&gt;&lt;/li&gt;&lt;li&gt;&lt;code data-end=&quot;404&quot; data-start=&quot;394&quot;&gt;accept()&lt;/code&gt; 返回一个新的 &lt;code data-end=&quot;423&quot; data-start=&quot;412&quot;&gt;client_fd&lt;/code&gt;。&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=0;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="668.25" y="142" width="366" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-113" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-96" target="tbstedJyYURACH70QP3b-112" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-114" value="&lt;ul style=&quot;line-height: 150%;&quot;&gt;&lt;li&gt;Nginx 从 &lt;code data-end=&quot;488&quot; data-start=&quot;473&quot;&gt;connections[]&lt;/code&gt;（连接池）空闲链表中取一个 &lt;code data-end=&quot;520&quot; data-start=&quot;502&quot;&gt;ngx_connection_t&lt;/code&gt;；&lt;br&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#ff3333&quot;&gt;将 &lt;code data-end=&quot;542&quot; data-start=&quot;531&quot;&gt;client_fd&lt;/code&gt; 绑定到这个 &lt;code data-end=&quot;567&quot; data-start=&quot;549&quot;&gt;ngx_connection_t&lt;/code&gt;；&lt;/font&gt;&lt;br&gt;&lt;/li&gt;&lt;li&gt;初始化其 &lt;code data-end=&quot;587&quot; data-start=&quot;581&quot;&gt;read&lt;/code&gt; / &lt;code data-end=&quot;597&quot; data-start=&quot;590&quot;&gt;write&lt;/code&gt; 指针，关联到 &lt;code data-end=&quot;620&quot; data-start=&quot;605&quot;&gt;read_events[]&lt;/code&gt; / &lt;code data-end=&quot;639&quot; data-start=&quot;623&quot;&gt;write_events[]&lt;/code&gt; 对应位置；&lt;br&gt;&lt;/li&gt;&lt;li&gt;&lt;font color=&quot;#ff3333&quot;&gt;设置 &lt;code data-end=&quot;662&quot; data-start=&quot;656&quot;&gt;data&lt;/code&gt; 指向上层 HTTP 请求对象（稍后创建）&lt;/font&gt;。&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;spacingLeft=0;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="1054.25" y="142" width="476" height="91" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-115" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-97" target="tbstedJyYURACH70QP3b-114" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-116" value="&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;当 &lt;code data-end=&quot;213&quot; data-start=&quot;203&quot;&gt;accept()&lt;/code&gt; 返回一个 &lt;code data-end=&quot;230&quot; data-start=&quot;219&quot;&gt;client_fd&lt;/code&gt; 时，Nginx 需要：&lt;/p&gt;&lt;ol style=&quot;line-height: 130%;&quot; data-end=&quot;565&quot; data-start=&quot;243&quot;&gt;&lt;li data-end=&quot;296&quot; data-start=&quot;243&quot;&gt;&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;296&quot; data-start=&quot;246&quot;&gt;&lt;strong data-end=&quot;295&quot; data-start=&quot;246&quot;&gt;从连接池 &lt;code data-end=&quot;268&quot; data-start=&quot;253&quot;&gt;connections[]&lt;/code&gt; 取一个空闲 &lt;code data-end=&quot;293&quot; data-start=&quot;275&quot;&gt;ngx_connection_t&lt;/code&gt;&lt;/strong&gt;；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;349&quot; data-start=&quot;297&quot;&gt;&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;349&quot; data-start=&quot;300&quot;&gt;&lt;strong data-end=&quot;348&quot; data-start=&quot;300&quot;&gt;把 &lt;code data-end=&quot;315&quot; data-start=&quot;304&quot;&gt;client_fd&lt;/code&gt; 存到这个 &lt;code data-end=&quot;343&quot; data-start=&quot;321&quot;&gt;ngx_connection_t-&amp;gt;fd&lt;/code&gt; 字段&lt;/strong&gt;；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;453&quot; data-start=&quot;350&quot;&gt;&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;453&quot; data-start=&quot;353&quot;&gt;&lt;strong data-end=&quot;367&quot; data-start=&quot;353&quot;&gt;初始化其读写事件指针&lt;/strong&gt;，让 &lt;code data-end=&quot;394&quot; data-start=&quot;370&quot;&gt;ngx_connection_t-&amp;gt;read&lt;/code&gt; / &lt;code data-end=&quot;404&quot; data-start=&quot;397&quot;&gt;write&lt;/code&gt; 分别指向 &lt;code data-end=&quot;429&quot; data-start=&quot;410&quot;&gt;read_events[slot]&lt;/code&gt; / &lt;code data-end=&quot;452&quot; data-start=&quot;432&quot;&gt;write_events[slot]&lt;/code&gt;；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;506&quot; data-start=&quot;454&quot;&gt;&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;506&quot; data-start=&quot;457&quot;&gt;&lt;strong data-end=&quot;487&quot; data-start=&quot;457&quot;&gt;将读事件的 &lt;code data-end=&quot;471&quot; data-start=&quot;465&quot;&gt;data&lt;/code&gt; 字段设置为指向这个连接对象&lt;/strong&gt;（&lt;code data-end=&quot;504&quot; data-start=&quot;488&quot;&gt;read-&amp;gt;data = c&lt;/code&gt;）；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;565&quot; data-start=&quot;507&quot;&gt;&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;565&quot; data-start=&quot;510&quot;&gt;通过 &lt;code data-end=&quot;540&quot; data-start=&quot;513&quot;&gt;epoll_ctl(ADD, client_fd)&lt;/code&gt; 把这个 fd 注册到 epoll，绑定事件回调。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;spacingLeft=14;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="737.25" y="312" width="444" height="168" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-117" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-114" target="tbstedJyYURACH70QP3b-116" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-118" value="&lt;p style=&quot;line-height: 80%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;// 假设当前有 &lt;code data-end=&quot;614&quot; data-start=&quot;596&quot;&gt;connections[100]&lt;/code&gt; 这个空闲的 &lt;code data-end=&quot;639&quot; data-start=&quot;621&quot;&gt;ngx_connection_t&lt;/code&gt;，&lt;code data-end=&quot;653&quot; data-start=&quot;643&quot;&gt;accept()&lt;/code&gt; 新建了 &lt;code data-end=&quot;674&quot; data-start=&quot;658&quot;&gt;client_fd = 56&lt;/code&gt;，Nginx 会：&lt;br&gt;&lt;br&gt;ngx_connection_t *c = &amp;amp;cycle-&amp;gt;connections[100];&amp;nbsp; // 取一个空闲连接&lt;/p&gt;&lt;p style=&quot;line-height: 80%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;c-&amp;gt;fd = 56;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 绑定 client_fd&lt;/p&gt;&lt;p style=&quot;line-height: 80%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;c-&amp;gt;read = &amp;amp;cycle-&amp;gt;read_events[100];&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;// 绑定读事件对象&lt;/p&gt;&lt;p style=&quot;line-height: 80%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;c-&amp;gt;write = &amp;amp;cycle-&amp;gt;write_events[100];&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 绑定写事件对象&lt;/p&gt;&lt;p style=&quot;line-height: 80%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;c-&amp;gt;read-&amp;gt;data = c;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; // 事件回调能找到连接&lt;/p&gt;&lt;p style=&quot;line-height: 80%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;c-&amp;gt;write-&amp;gt;data = c;&lt;/p&gt;&lt;div style=&quot;line-height: 80%;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;spacingLeft=14;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="664.75" y="518" width="589" height="196" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-119" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-116" target="tbstedJyYURACH70QP3b-118" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-120" value="&lt;p style=&quot;line-height: 130%;&quot; data-end=&quot;242&quot; data-start=&quot;201&quot;&gt;当 Nginx 建立一个连接后，&lt;code data-end=&quot;51&quot; data-start=&quot;33&quot;&gt;ngx_connection_t&lt;/code&gt; 只是底层 socket 的抽象，&lt;strong data-end=&quot;92&quot; data-start=&quot;68&quot;&gt;它本身并不存储 HTTP 请求的全部信息&lt;/strong&gt;。&lt;br data-end=&quot;96&quot; data-start=&quot;93&quot;&gt;&lt;br&gt;当真正收到 HTTP 请求时，Nginx 会为这个连接创建一个 &lt;code data-end=&quot;148&quot; data-start=&quot;128&quot;&gt;ngx_http_request_t&lt;/code&gt;（HTTP 请求对象），并把 &lt;code data-end=&quot;187&quot; data-start=&quot;163&quot;&gt;&lt;b&gt;ngx_connection_t-&amp;gt;data&lt;/b&gt;&lt;/code&gt; 指针指向这个请求对象，以便后续所有事件处理时都能找到 HTTP 层上下文&lt;br&gt;&lt;/p&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;spacingLeft=14;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="1344.25" y="316" width="586" height="102" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-121" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-114" target="tbstedJyYURACH70QP3b-120" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-122" value="&lt;ol data-end=&quot;711&quot; data-start=&quot;253&quot;&gt;&lt;li data-end=&quot;353&quot; data-start=&quot;253&quot;&gt;&lt;p data-end=&quot;278&quot; data-start=&quot;256&quot;&gt;&lt;strong data-end=&quot;275&quot; data-start=&quot;256&quot;&gt;刚 accept() 新连接时&lt;/strong&gt;：&lt;/p&gt;&lt;ul data-end=&quot;353&quot; data-start=&quot;282&quot;&gt;&lt;li data-end=&quot;353&quot; data-start=&quot;282&quot;&gt;&lt;p data-end=&quot;353&quot; data-start=&quot;284&quot;&gt;&lt;code data-end=&quot;293&quot; data-start=&quot;284&quot;&gt;c-&amp;gt;data&lt;/code&gt; 可能先指向一个简单的回调处理函数的上下文，例如 &lt;code data-end=&quot;347&quot; data-start=&quot;318&quot;&gt;ngx_http_init_connection(c)&lt;/code&gt; 处理阶段&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li data-end=&quot;537&quot; data-start=&quot;355&quot;&gt;&lt;p data-end=&quot;380&quot; data-start=&quot;358&quot;&gt;&lt;strong data-end=&quot;377&quot; data-start=&quot;358&quot;&gt;当开始接收 HTTP 请求头时&lt;/strong&gt;&lt;/p&gt;&lt;ul data-end=&quot;537&quot; data-start=&quot;384&quot;&gt;&lt;li data-end=&quot;451&quot; data-start=&quot;384&quot;&gt;&lt;p data-end=&quot;451&quot; data-start=&quot;386&quot;&gt;Nginx 调用 &lt;code data-end=&quot;423&quot; data-start=&quot;395&quot;&gt;ngx_http_create_request(c)&lt;/code&gt; 创建 &lt;code data-end=&quot;450&quot; data-start=&quot;427&quot;&gt;ngx_http_request_t *r&lt;/code&gt;；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;489&quot; data-start=&quot;455&quot;&gt;&lt;p data-end=&quot;489&quot; data-start=&quot;457&quot;&gt;这个 &lt;code data-end=&quot;463&quot; data-start=&quot;460&quot;&gt;r&lt;/code&gt; 保存 HTTP 请求的状态、解析缓冲、响应链表等；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;537&quot; data-start=&quot;493&quot;&gt;&lt;p data-end=&quot;537&quot; data-start=&quot;495&quot;&gt;&lt;strong data-end=&quot;517&quot; data-start=&quot;495&quot;&gt;然后执行 &lt;code data-end=&quot;515&quot; data-start=&quot;502&quot;&gt;c-&amp;gt;data = r&lt;/code&gt;&lt;/strong&gt;，把连接对象和 HTTP 请求对象绑定。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li data-end=&quot;711&quot; data-start=&quot;539&quot;&gt;&lt;p data-end=&quot;572&quot; data-start=&quot;542&quot;&gt;&lt;strong data-end=&quot;571&quot; data-start=&quot;542&quot;&gt;以后所有的事件（EPOLLIN/EPOLLOUT）&lt;/strong&gt;：&lt;/p&gt;&lt;ul data-end=&quot;711&quot; data-start=&quot;576&quot;&gt;&lt;li data-end=&quot;640&quot; data-start=&quot;576&quot;&gt;&lt;p data-end=&quot;640&quot; data-start=&quot;578&quot;&gt;当 epoll 返回事件时，通过 &lt;code data-end=&quot;613&quot; data-start=&quot;595&quot;&gt;c-&amp;gt;read-&amp;gt;handler&lt;/code&gt; 或 &lt;code data-end=&quot;635&quot; data-start=&quot;616&quot;&gt;c-&amp;gt;write-&amp;gt;handler&lt;/code&gt; 被调用；&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;711&quot; data-start=&quot;644&quot;&gt;&lt;p data-end=&quot;711&quot; data-start=&quot;646&quot;&gt;事件处理函数内部会通过 &lt;code data-end=&quot;692&quot; data-start=&quot;658&quot;&gt;ngx_http_request_t *r = c-&amp;gt;data;&lt;/code&gt; 找到 HTTP 请求对象来处理业务。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;align=left;spacingLeft=7;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="tbstedJyYURACH70QP3b-124" vertex="1">
          <mxGeometry x="1308.25" y="514" width="658" height="281" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-123" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=0;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tbstedJyYURACH70QP3b-124" source="tbstedJyYURACH70QP3b-120" target="tbstedJyYURACH70QP3b-122" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-129" value="请求内存池" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1321" y="2289" width="97" height="33" as="geometry" />
        </mxCell>
        <mxCell id="tbstedJyYURACH70QP3b-130" value="连接内存池" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="1612.5" y="2291" width="97" height="33" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-30" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="474" y="-1435" width="1287" height="607" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=2;startArrow=classic;startFill=1;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-1" target="2pCcyZzb-pndT4Qp4Zei-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-1" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;Nginx&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontColor=#ffffff;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="541" y="335" width="188" height="88" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-2" value="&lt;font size=&quot;1&quot; style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 26px;&quot;&gt;Nginx 相关的生产问题解决思路&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="417" width="464" height="89" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;startArrow=classic;startFill=1;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-3" target="2pCcyZzb-pndT4Qp4Zei-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-12" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-3" target="2pCcyZzb-pndT4Qp4Zei-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-13" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-3" target="2pCcyZzb-pndT4Qp4Zei-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-14" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-3" target="2pCcyZzb-pndT4Qp4Zei-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-3" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;网络&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontColor=#ffffff;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="242" y="334" width="188" height="88" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-23" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-4" target="2pCcyZzb-pndT4Qp4Zei-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-24" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-4" target="2pCcyZzb-pndT4Qp4Zei-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-25" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-4" target="2pCcyZzb-pndT4Qp4Zei-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-26" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-30" source="2pCcyZzb-pndT4Qp4Zei-4" target="2pCcyZzb-pndT4Qp4Zei-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-4" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;资源&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a20025;strokeColor=#6F0000;fontColor=#ffffff;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="840" y="336" width="188" height="88" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-8" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;TCP&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry y="189" width="158" height="77" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-9" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;HTTP&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry y="339.5" width="158" height="77" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-10" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;SSL/TLS&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry y="479" width="158" height="77" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-15" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;计算&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="1136.5" y="136" width="150.5" height="68" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-16" value="&lt;span style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;内存&lt;/b&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="1129.75" y="273" width="157.25" height="70" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-17" value="&lt;span style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;网络&lt;/b&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="1130.25" y="403" width="154" height="72" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-22" value="&lt;span style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;磁盘IO&lt;/b&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-30">
          <mxGeometry x="1129.75" y="535" width="154" height="72" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-31" value="Nginx事件驱动框架与HTTP等状态机的关系&lt;div&gt;&lt;strong data-end=&quot;2188&quot; data-start=&quot;2178&quot;&gt;事件驱动框架&lt;/strong&gt;：提供“什么时候可以继续干活”的调度与唤醒（I/O 就绪和定时器）。&lt;/div&gt;&lt;div&gt;&lt;strong data-end=&quot;2239&quot; data-start=&quot;2227&quot;&gt;HTTP 状态机&lt;/strong&gt;：定义“每次被唤醒要干哪一小步活”，并决定下一步要监听什么事件/超时。&lt;br&gt;&amp;nbsp;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;" vertex="1" parent="1">
          <mxGeometry x="1908" y="-713" width="711" height="146" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-47" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="617" y="-678" width="831" height="525" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-41" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;dashed=1;dashPattern=8 8;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-47" source="2pCcyZzb-pndT4Qp4Zei-32" target="2pCcyZzb-pndT4Qp4Zei-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-32" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;Nginx&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;labelBackgroundColor=none;fillColor=#008a00;strokeColor=#005700;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-47">
          <mxGeometry x="412" y="55" width="299" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-40" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;labelBackgroundColor=default;endArrow=classic;strokeWidth=2;dashed=1;dashPattern=8 8;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-47" source="2pCcyZzb-pndT4Qp4Zei-33" target="2pCcyZzb-pndT4Qp4Zei-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-33" value="&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;网络 TCP/IP 协议栈&lt;/b&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;labelBackgroundColor=none;fillColor=#0050ef;strokeColor=#001DBC;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-47">
          <mxGeometry x="412" y="393" width="299" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-43" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-47" source="2pCcyZzb-pndT4Qp4Zei-34" target="2pCcyZzb-pndT4Qp4Zei-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-44" value="&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;b&gt;通知就绪&lt;/b&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;" vertex="1" connectable="0" parent="2pCcyZzb-pndT4Qp4Zei-43">
          <mxGeometry x="-0.385" y="-29" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-45" style="edgeStyle=orthogonalEdgeStyle;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" edge="1" parent="2pCcyZzb-pndT4Qp4Zei-47" source="2pCcyZzb-pndT4Qp4Zei-34" target="2pCcyZzb-pndT4Qp4Zei-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-46" value="&lt;font size=&quot;1&quot; style=&quot;&quot;&gt;&lt;b style=&quot;font-size: 17px;&quot;&gt;监听&lt;/b&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;" vertex="1" connectable="0" parent="2pCcyZzb-pndT4Qp4Zei-45">
          <mxGeometry x="0.2213" y="18" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-34" value="&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;EPOLL( ) 系统调用&lt;/b&gt;&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;labelBackgroundColor=none;fillColor=#a20025;strokeColor=#6F0000;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-47">
          <mxGeometry x="88" y="243" width="299" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-37" value="&lt;font color=&quot;#cc0000&quot; style=&quot;font-size: 14px;&quot;&gt;负责 &lt;strong data-start=&quot;464&quot; data-end=&quot;480&quot;&gt;TCP 连接建立与状态机&lt;/strong&gt;（SYN/ACK、重传、拥塞控制、FIN/RST 等）&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#cc0000&quot; style=&quot;font-size: 14px;&quot;&gt;以及把数据放到套接字接收缓冲区。维护socket状态&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=none;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-47">
          <mxGeometry x="349" y="467" width="482" height="58" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-38" value="&lt;font style=&quot;font-size: 14px;&quot; color=&quot;#cc0000&quot;&gt;（事件驱动框架）只是&lt;strong data-start=&quot;364&quot; data-end=&quot;372&quot; style=&quot;&quot;&gt;通知就绪&lt;/strong&gt;的机制，不做协议解析、不收发数据&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;你可以理解为“唤醒器”：告诉 Nginx 哪些 fd 现在可以读/写了。&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;strong data-end=&quot;1121&quot; data-start=&quot;1040&quot;&gt;&amp;nbsp;epoll 维护 fd 的就绪集合 → &lt;code data-end=&quot;1097&quot; data-start=&quot;1083&quot;&gt;epoll_wait()&lt;/code&gt; 通知 Nginx 哪些 fd 可读/可写”&lt;/strong&gt;。&lt;/font&gt;&lt;font style=&quot;font-size: 14px;&quot; color=&quot;#cc0000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-47">
          <mxGeometry y="171" width="482" height="58" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-39" value="&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;接收数据后，进入对应&lt;b&gt;状态机&lt;/b&gt;，对其进行&lt;b&gt;处理&lt;/b&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=none;" vertex="1" parent="2pCcyZzb-pndT4Qp4Zei-47">
          <mxGeometry x="324" width="482" height="58" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-48" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="-915" y="152" width="1966" height="457.44000000000005" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--1" value="&lt;b&gt;Nginx&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;fontColor=#ffffff;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="738" width="109" height="45" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--3" value="操作体统" style="rounded=1;whiteSpace=wrap;html=1;container=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="550" y="82" width="527" height="44" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--2" value="epoll机制" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oCp0Jb_trErku0qVtbz--3" vertex="1">
          <mxGeometry x="30.688755020080325" y="3.5" width="142.86144578313255" height="37" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--22" value="完整事件处理流程" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="oCp0Jb_trErku0qVtbz--3" vertex="1">
          <mxGeometry x="418" y="3.5" width="100.95" height="37" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--1" target="oCp0Jb_trErku0qVtbz--2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-38" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--6" target="tlIEBAkVMEHic_1Gy2fF-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--6" value="epoll_create()&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;创建epoll实例&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="482" y="167" width="94" height="37" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-37" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--7" target="tlIEBAkVMEHic_1Gy2fF-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--7" value="epoll_ctl()&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;注册监听socket fd&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="607.37" y="168" width="89.5" height="36" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--15" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--8" target="oCp0Jb_trErku0qVtbz--14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--8" value="epoll_wait()&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;让内核阻塞等待事件&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="714" y="168" width="118" height="36" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--2" target="oCp0Jb_trErku0qVtbz--7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--10" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--2" target="oCp0Jb_trErku0qVtbz--6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--11" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--2" target="oCp0Jb_trErku0qVtbz--8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--14" value="1. nginx 调用 epoll_wait() 监听一批 fd&lt;div&gt;2.&amp;nbsp;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;某客户端通过连接 conn_fd 发送数据&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;3.&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;数据到达服务端后被放入内核的接收缓存区中&lt;br&gt;4. 内核将这个 conn_fd 标记为可读&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;5. Nginx 调用 read() 处理数据&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=11;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="475" y="254" width="265" height="82" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--28" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--23" target="oCp0Jb_trErku0qVtbz--24" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--30" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--23" target="oCp0Jb_trErku0qVtbz--26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--23" value="监听和等待阶段&lt;br&gt;（内核空间）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="865" y="167" width="148" height="36" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--29" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--24" target="oCp0Jb_trErku0qVtbz--25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--32" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--24" target="oCp0Jb_trErku0qVtbz--31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--24" value="事件触发阶段&lt;br&gt;（内核空间 -&amp;gt; 用户空间）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="1330" y="168" width="167" height="36" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--35" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--25" target="oCp0Jb_trErku0qVtbz--33" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--25" value="Nginx分发处理阶段&lt;br&gt;（用户态操作）" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="1708.5" y="168" width="151" height="36" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--26" value="1. &lt;b&gt;nginx 初始化时&lt;/b&gt;：&lt;br&gt;&amp;nbsp; &amp;nbsp; a. 调用 epoll_create() 创建 epoll 实例&lt;br&gt;&amp;nbsp; &amp;nbsp; b. 调用 epoll_ctl() 注册监听 socket fd (监听连接) 或已连接fd（监听读写）&lt;div&gt;&lt;br&gt;&lt;div&gt;2. &lt;b&gt;进入事件循环：&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp;&lt;/b&gt; a. 调用 epoll_wait(epfd, events[], MAX_EVENTS, timeout) 让内核阻塞等待事件&lt;br&gt;&amp;nbsp; &amp;nbsp; b. 此时，Nginx处于【等待事件状态】（比如连接到达，数据可读）&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=11;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="756" y="249" width="426" height="121" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--27" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--22" target="oCp0Jb_trErku0qVtbz--23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--31" value="1. 当某个fd有事件（如可读）时：&lt;div&gt;&amp;nbsp; &amp;nbsp; a. 内核将事件信息（例如：fd = 5, EPOLLIN）加入内核的ready list&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; b. epoll_wait()被唤醒，将事件元数据复制到用户空间的events[ ]数组&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;注意：这里只是复制了“事件描述信息”，而不是 socket 中的实际数据&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=11;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="1205" y="249" width="364" height="121" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--33" value="1.&lt;b&gt; Nginx 遍历 events[ ] 数组：&lt;/b&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; a. 对每个就绪事件，找到其对应的 handler 函数&lt;br&gt;&amp;nbsp; &amp;nbsp; b. handler 函数会决定是否继续下一步，如调用read() 读取数据&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. &lt;b&gt;调用 read(fd, buf, size) / recv()：&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt; &amp;nbsp; a. 这个时候才发生 【数据复制】：&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (1) 从内核的socket接收缓冲区（TCP recv buffer）&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; (2) 复制数据到用户空间缓冲区 （如：char buf[1024]）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. &lt;b&gt;数据读取成功后&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&amp;nbsp; &amp;nbsp; &lt;/b&gt;a. Nginx handler 开始执行业务逻辑 （比如解析HTTP请求）&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#f8cecc;strokeColor=#b85450;align=left;spacingLeft=11;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="1602" y="249" width="364" height="177" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--39" value="&lt;span&gt;红黑树&lt;/span&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="349" y="35" width="93" height="38" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--40" value="链表" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry x="349" y="140" width="93" height="38" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--41" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--2" target="oCp0Jb_trErku0qVtbz--39" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="oCp0Jb_trErku0qVtbz--42" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;labelBackgroundColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="oCp0Jb_trErku0qVtbz--2" target="oCp0Jb_trErku0qVtbz--40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-4" value="" style="group" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1" connectable="0">
          <mxGeometry x="46" y="267" width="384" height="190.44" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-3" value="" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="14.309999999999999" y="1.44" width="334.46" height="189" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-27" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-3" target="9Dw6ee0XKq7G6TXhmcGK-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-28" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-3" target="9Dw6ee0XKq7G6TXhmcGK-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="88" y="51" />
              <mxPoint x="114" y="51" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-3" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#e51400;fontColor=#ffffff;strokeColor=#B20000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="77.78251599147121" y="15.092172154356442" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-10" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-4" target="9Dw6ee0XKq7G6TXhmcGK-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-14" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-4" target="9Dw6ee0XKq7G6TXhmcGK-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="61" y="98" />
              <mxPoint x="88" y="98" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-4" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#000000;fontColor=#ffffff;strokeColor=#000000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="50.76332622601279" y="65.39742496561767" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-15" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-5" target="9Dw6ee0XKq7G6TXhmcGK-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="114" y="100" />
              <mxPoint x="88" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-17" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-5" target="9Dw6ee0XKq7G6TXhmcGK-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-30" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-5" target="9Dw6ee0XKq7G6TXhmcGK-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-5" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#000000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="103.98294243070362" y="65.39742496561767" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-6" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#e51400;fontColor=#ffffff;strokeColor=#B20000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="77.78251599147121" y="114.26465091821049" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-7" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#e51400;fontColor=#ffffff;strokeColor=#B20000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="22.925373134328357" y="114.26342771620419" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-8" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#000000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="108.07675906183368" y="163.12652536202572" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-24" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-9" target="9Dw6ee0XKq7G6TXhmcGK-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-29" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-9" target="9Dw6ee0XKq7G6TXhmcGK-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-9" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#e51400;fontColor=#ffffff;strokeColor=#B20000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="131.00213219616205" y="116.42054445433216" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-11" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="171.12153518123668" y="15.092783755359598" width="20.840304182509506" height="20.840304182509506" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-12" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="216.15351812366737" y="15.092783755359598" width="20.840304182509506" height="20.840304182509506" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-11" target="9Dw6ee0XKq7G6TXhmcGK-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-13" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="269.3731343283582" y="15.092783755359598" width="20.840304182509506" height="20.840304182509506" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-12" target="9Dw6ee0XKq7G6TXhmcGK-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-14" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d5e8d4;strokeColor=#82b366;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="315.2238805970149" y="15.092783755359598" width="20.840304182509506" height="20.840304182509506" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-13" target="9Dw6ee0XKq7G6TXhmcGK-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-31" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-10" target="9Dw6ee0XKq7G6TXhmcGK-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9Dw6ee0XKq7G6TXhmcGK-10" value="" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#000000;" parent="tlIEBAkVMEHic_1Gy2fF-4" vertex="1">
          <mxGeometry x="153.9275053304904" y="163.12927756653994" width="20.121673003802282" height="20.121673003802282" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-18" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="tlIEBAkVMEHic_1Gy2fF-4" source="9Dw6ee0XKq7G6TXhmcGK-9" target="9Dw6ee0XKq7G6TXhmcGK-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-35" value="红黑树上有两种fd:&lt;br&gt;listen_fd和client_fd&lt;br&gt;可以通过查看/proc/nginx_pid/fd进行查看" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fillColor=#f8cecc;strokeColor=#b85450;" parent="2pCcyZzb-pndT4Qp4Zei-48" vertex="1">
          <mxGeometry y="163" width="215" height="60" as="geometry" />
        </mxCell>
        <mxCell id="tlIEBAkVMEHic_1Gy2fF-36" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-48" source="9Dw6ee0XKq7G6TXhmcGK-3" target="tlIEBAkVMEHic_1Gy2fF-35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-49" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="-651" y="790" width="1233" height="453" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-1" value="&lt;b&gt;traditional server&lt;br&gt;同一时间只处理一个请求&lt;br&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="239.44144144144144" width="215.99099099099098" height="68.54605263157895" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-2" value="&lt;b&gt;Nginx&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="657.8468468468469" width="187.6036036036036" height="68.54605263157895" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-3" value="&lt;b&gt;VS&lt;/b&gt;" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#d80073;fontColor=#ffffff;strokeColor=#A50040;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="535.6576576576578" y="5.9605263157894735" width="45.873873873873876" height="45.873873873873876" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="241.90990990990989" y="140.07236842105263" width="34.55855855855855" height="312.92763157894734" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-5" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="336.94594594594594" y="140.07236842105263" width="34.55855855855855" height="312.92763157894734" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-6" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="424.5765765765766" y="134.11184210526315" width="34.55855855855855" height="312.92763157894734" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-7" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="729.4324324324324" y="96.85855263157895" width="34.55855855855855" height="96.85855263157895" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-56" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-8" target="7tuyBMnh53eZHOQNJwQC-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-8" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="729.4324324324324" y="177.32565789473682" width="34.55855855855855" height="113.25" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-9" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="729.4324324324324" y="266.73355263157896" width="34.55855855855855" height="120.70065789473684" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-11" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="729.4324324324324" y="344.2203947368421" width="34.55855855855855" height="98.34868421052632" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-12" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;process1&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="224.6306306306306" y="95.36842105263158" width="69.1171171171171" height="38.743421052631575" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-13" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;process2&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="319.6666666666666" y="95.36842105263158" width="69.1171171171171" height="38.743421052631575" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-14" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;process3&lt;br&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="412.2342342342342" y="95.36842105263158" width="69.1171171171171" height="34.27302631578947" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-15" value="&lt;p style=&quot;line-height: 30%;&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;request1&lt;/font&gt;&lt;/p&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a20025;strokeColor=#6F0000;fontColor=#ffffff;align=left;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="241.90990990990989" y="140.07236842105263" width="34.55855855855855" height="89.4078947368421" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-16" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request1&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="336.94594594594594" y="223.51973684210526" width="34.55855855855855" height="61.0953947368421" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="424.01873910705586" y="317.1707181088312" as="targetPoint" />
            <Array as="points">
              <mxPoint x="350.5225225225225" y="315.9078947368421" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-17" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request2&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a20025;strokeColor=#6F0000;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="241.90990990990989" y="296.5361842105263" width="34.55855855855855" height="20.861842105263158" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-18" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request2&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="336.94594594594594" y="338.2598684210526" width="34.55855855855855" height="46.19407894736842" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-19" target="7tuyBMnh53eZHOQNJwQC-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-19" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request1&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="424.5765765765766" y="280.14473684210526" width="34.55855855855855" height="20.861842105263158" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-20" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request2&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="424.5765765765766" y="317.3980263157895" width="34.55855855855855" height="20.861842105263158" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.015;entryY=0.217;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="276.4684684684684" y="223.51973684210526" as="sourcePoint" />
            <mxPoint x="337.4643243243243" y="224.3691118421055" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.008;entryY=0.416;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="371.50450450450444" y="280.14473684210526" as="sourcePoint" />
            <mxPoint x="424.8530450450448" y="281.053717105263" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1.011;entryY=0.633;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-20" target="7tuyBMnh53eZHOQNJwQC-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="411" y="338.2598684210526" />
              <mxPoint x="411" y="338.2598684210526" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.955;entryY=0.781;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-18" target="7tuyBMnh53eZHOQNJwQC-4" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="330.7747747747748" y="384.45394736842104" />
              <mxPoint x="330.7747747747748" y="384.45394736842104" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-35" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request3&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a20025;strokeColor=#6F0000;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="241.90990990990989" y="384.45394736842104" width="34.55855855855855" height="20.861842105263158" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-39" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request3&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="336.94594594594594" y="405.3157894736842" width="34.55855855855855" height="13.411184210526315" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.847;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#008a00;strokeColor=#005700;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-35" target="7tuyBMnh53eZHOQNJwQC-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="306.09009009009003" y="405.3157894736842" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-41" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;request3&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontColor=#ffffff;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="424.5765765765766" y="418.7269736842105" width="34.55855855855855" height="28.3125" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=-0.012;entryY=0.909;entryDx=0;entryDy=0;entryPerimeter=0;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-39" target="7tuyBMnh53eZHOQNJwQC-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="397.4234234234234" y="418.7269736842105" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-44" value="&lt;font style=&quot;font-size: 7px;&quot;&gt;假设每个process(连接)分为3个请求&lt;br&gt;&lt;b&gt;读请求&lt;/b&gt;：读取header首部，从而知晓上游服务器地址&lt;br&gt;&lt;b&gt;读请求&lt;/b&gt;：读取contest_lenth，了解包体长度&lt;br&gt;&lt;b&gt;写请求&lt;/b&gt;：生成响应返回给客户端&lt;br&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry y="195.20723684210526" width="171.55855855855856" height="138.58223684210526" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.991;entryY=0.673;entryDx=0;entryDy=0;entryPerimeter=0;curved=1;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-17" target="7tuyBMnh53eZHOQNJwQC-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-47" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1.004;entryY=0.87;entryDx=0;entryDy=0;entryPerimeter=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-35" target="7tuyBMnh53eZHOQNJwQC-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-51" style="edgeStyle=orthogonalEdgeStyle;shape=connector;curved=1;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1.001;entryY=0.364;entryDx=0;entryDy=0;entryPerimeter=0;labelBackgroundColor=default;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;" parent="2pCcyZzb-pndT4Qp4Zei-49" source="7tuyBMnh53eZHOQNJwQC-15" target="7tuyBMnh53eZHOQNJwQC-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-53" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;当request1不满足时，进行切换&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=default;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="280.1711711711711" y="178.8157894736842" width="51.83783783783784" height="25.332236842105264" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-54" value="&lt;h2 style=&quot;font-size: 6px;&quot; data-end=&quot;93&quot; data-start=&quot;80&quot;&gt;&lt;ol style=&quot;&quot; data-end=&quot;611&quot; data-start=&quot;95&quot;&gt;&lt;li style=&quot;&quot; data-end=&quot;202&quot; data-start=&quot;95&quot;&gt;&lt;p data-end=&quot;130&quot; data-start=&quot;98&quot;&gt;&lt;strong data-end=&quot;128&quot; data-start=&quot;98&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;当前 epoll_wait 返回的 events[]&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;&lt;ul data-end=&quot;202&quot; data-start=&quot;134&quot;&gt;&lt;li data-end=&quot;172&quot; data-start=&quot;134&quot;&gt;&lt;p data-end=&quot;172&quot; data-start=&quot;136&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;这是内核 &lt;strong data-end=&quot;162&quot; data-start=&quot;141&quot;&gt;ready_list → 用户空间&lt;/strong&gt; 的一次性拷贝。&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;202&quot; data-start=&quot;176&quot;&gt;&lt;p data-end=&quot;202&quot; data-start=&quot;178&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;Nginx 在这次循环中扫描并尝试处理每个事件。&lt;/font&gt;&lt;/p&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li style=&quot;&quot; data-end=&quot;351&quot; data-start=&quot;204&quot;&gt;&lt;p data-end=&quot;226&quot; data-start=&quot;207&quot;&gt;&lt;strong data-end=&quot;224&quot; data-start=&quot;207&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;资源不足时（无法完成处理）&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;&lt;ul data-end=&quot;351&quot; data-start=&quot;230&quot;&gt;&lt;li data-end=&quot;277&quot; data-start=&quot;230&quot;&gt;&lt;p data-end=&quot;277&quot; data-start=&quot;232&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;Nginx &lt;strong data-end=&quot;260&quot; data-start=&quot;238&quot;&gt;不会保留这个事件在 events[]&lt;/strong&gt;，因为这个数组是一次性缓冲区；&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;351&quot; data-start=&quot;281&quot;&gt;&lt;p data-end=&quot;351&quot; data-start=&quot;283&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;处理失败的 fd 并不会被 &lt;code data-end=&quot;313&quot; data-start=&quot;297&quot;&gt;epoll_ctl(DEL)&lt;/code&gt; 删除，而是 &lt;strong data-end=&quot;339&quot; data-start=&quot;320&quot;&gt;仍然保留在 epoll 红黑树&lt;/strong&gt; 里，等待后续状态变化。&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;li style=&quot;&quot; data-end=&quot;476&quot; data-start=&quot;353&quot;&gt;&lt;p data-end=&quot;375&quot; data-start=&quot;356&quot;&gt;&lt;strong data-end=&quot;373&quot; data-start=&quot;356&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;fd 的状态在内核保持监控&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;&lt;ul data-end=&quot;476&quot; data-start=&quot;379&quot;&gt;&lt;li data-end=&quot;419&quot; data-start=&quot;379&quot;&gt;&lt;p data-end=&quot;419&quot; data-start=&quot;381&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;由于 fd 仍然注册在 epoll 中，内核继续关注它的 I/O 状态；&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;li data-end=&quot;476&quot; data-start=&quot;423&quot;&gt;&lt;p data-end=&quot;476&quot; data-start=&quot;425&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;当资源恢复、socket 再次可读/可写时，&lt;strong data-end=&quot;475&quot; data-start=&quot;447&quot;&gt;内核重新把这个 fd 挂到 ready_list&lt;/strong&gt;。&lt;/font&gt;&lt;/p&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li style=&quot;&quot; data-end=&quot;611&quot; data-start=&quot;478&quot;&gt;&lt;p style=&quot;&quot; data-end=&quot;501&quot; data-start=&quot;481&quot;&gt;&lt;strong data-end=&quot;499&quot; data-start=&quot;481&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;下一轮 epoll_wait&lt;/font&gt;&lt;/strong&gt;&lt;/p&gt;&lt;ul style=&quot;&quot; data-end=&quot;611&quot; data-start=&quot;505&quot;&gt;&lt;li style=&quot;&quot; data-end=&quot;535&quot; data-start=&quot;505&quot;&gt;&lt;p data-end=&quot;535&quot; data-start=&quot;507&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;Nginx 再次调用 &lt;code data-end=&quot;532&quot; data-start=&quot;518&quot;&gt;epoll_wait()&lt;/code&gt;；&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;&quot; data-end=&quot;592&quot; data-start=&quot;539&quot;&gt;&lt;p data-end=&quot;592&quot; data-start=&quot;541&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;内核检测 ready_list 里又有这个 fd，就会重新把它拷贝到用户态 &lt;code data-end=&quot;589&quot; data-start=&quot;579&quot;&gt;events[]&lt;/code&gt;；&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;li style=&quot;&quot; data-end=&quot;611&quot; data-start=&quot;596&quot;&gt;&lt;p style=&quot;&quot; data-end=&quot;611&quot; data-start=&quot;598&quot;&gt;&lt;font style=&quot;font-size: 6px;&quot;&gt;Nginx 重新尝试处理。&lt;/font&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/h2&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;align=left;spacingLeft=0;fillColor=#f8cecc;strokeColor=#b85450;spacingRight=0;spacing=-22;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="816.337925445705" y="123" width="365.74337115072933" height="303.18" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-57" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;一次切换时5微秒，但是当并发连接数变多，切换时间的会指数级提升，进程间消耗会非常可观&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=default;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="471.4774774774775" y="195.20723684210526" width="41.96396396396396" height="177.32565789473682" as="geometry" />
        </mxCell>
        <mxCell id="7tuyBMnh53eZHOQNJwQC-58" value="&lt;font style=&quot;font-size: 6px;&quot;&gt;Nginx只有在worker进程时间片到了的情况下会发生，而时间片长度与CPU优先级有关，因此通常nginx优化，会将优先级调高&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontFamily=Helvetica;fontColor=default;" parent="2pCcyZzb-pndT4Qp4Zei-49" vertex="1">
          <mxGeometry x="676.3603603603603" y="158.69901315789474" width="41.96396396396396" height="250.3421052631579" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-50" value="&lt;b&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;阻塞 / 非阻塞&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;labelBackgroundColor=none;fillColor=#0050ef;strokeColor=#001DBC;" vertex="1" parent="1">
          <mxGeometry x="2908" y="1853" width="135" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-53" value="&lt;b&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;同步 / 异步&lt;/font&gt;&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=#ffffff;labelBackgroundColor=none;fillColor=#a20025;strokeColor=#6F0000;" vertex="1" parent="1">
          <mxGeometry x="3336" y="1853" width="135" height="60" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-55" value="&lt;strong data-end=&quot;640&quot; data-start=&quot;613&quot;&gt;阻塞/非阻塞关注“调用时会不会让当前线程睡眠”&lt;br&gt;&lt;/strong&gt;（从而通常触发 CPU 切换）。" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="2841" y="1964" width="263" height="75" as="geometry" />
        </mxCell>
        <mxCell id="2pCcyZzb-pndT4Qp4Zei-56" value="&lt;strong data-end=&quot;692&quot; data-start=&quot;661&quot;&gt;同步/异步关注“结果是自己去等&lt;/strong&gt;&lt;div&gt;&lt;strong data-end=&quot;692&quot; data-start=&quot;661&quot;&gt;还是别人完成后通知你”&lt;/strong&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="3299" y="1967" width="204" height="72" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
